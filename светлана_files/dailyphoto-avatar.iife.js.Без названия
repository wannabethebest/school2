this.OK=this.OK||{},this.OK.dailyphoto=this.OK.dailyphoto||{},this.OK.dailyphoto.dailyphotoAvatar=function(t,i,n){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=r(window.OK.dailyphoto.logger);function u(t,i,n,r){var o,u=arguments.length,e=u<3?i:null===r?r=Object.getOwnPropertyDescriptor(i,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)e=Reflect.decorate(t,i,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(e=(u<3?o(e):u>3?o(i,n,e):o(i,n))||e);return u>3&&e&&Object.defineProperty(i,n,e),e}function e(t,i,n){var r=performance.now();!function o(){var u=performance.now(),e=Math.min(1,(u-r)/t);if(i(e),1===e)return n();window.requestAnimationFrame(o)}()}function s(t,i){t.style["stroke-dasharray"]=i+","+i,t.style.opacity="1"}function f(t,i,n){return new Promise((function(r){e(1e3,(function(r){t.style["stroke-dashoffset"]=String(i+(n-i)*r)}),r)}))}function c(t){t.style.opacity="0",h(t)}function h(t){t.style["stroke-dasharray"]=null,t.style["stroke-dashoffset"]=null}function a(i){i.classList.remove(t.globalStore.externalCssClasses.PROGRESS)}function l(i,n,r,o,u){!t.globalStore.isMobile&&window.OK.Layers.isAnyLayerOpened()||!i?o.style.opacity="1":setTimeout((function(){s(n,i),s(r,i),c(o),Promise.all([f(n,i,i/2),f(r,0-i,0-i/2)]).then((function(){return function(t){return new Promise((function(i){e(1e3,(function(i){t.style.opacity=String(i)}),i)}))}(o)})).then((function(){return c(n),c(r),function(t){return new Promise((function(i){e(2e3,(function(i){var n=135+540*i;t.setAttribute("gradientTransform","rotate("+n+" 0.5 0.5)")}),i)}))}(u)}))}),1e3)}var v=function(i){function n(){i.call(this),this.uploads=t.globalStore.getModel((function(){return t.globalStore.uploads})),this.uploadStatus=t.globalStore.getModel((function(){return t.globalStore.uploadStatus}))}return i&&(n.__proto__=i),n.prototype=Object.create(i&&i.prototype),n.prototype.constructor=n,n}(i.AbstractStore);u([i.watched],v.prototype,"uploads",void 0),u([i.watched],v.prototype,"uploadStatus",void 0);var d=function(i){function n(){var n=this;i.call(this,new v),this.t=null,this.i=0,this.o=!1,this.handleUploads=function(){n.u(!0)},this.handleUploadStatus=function(){n.u(!0)},this.h=function(i){n.t&&(n.t.classList.contains(t.globalStore.externalCssClasses.PROGRESS)||n.t.classList.contains(t.globalStore.externalCssClasses.ERROR))&&(i.stopPropagation(),i.preventDefault(),t.globalCtrl.openLayer({ownerId:t.globalStore.myOwnerId,source:"my_profile",origin:"UNKNOWN"}))}}return i&&(n.__proto__=i),n.prototype=Object.create(i&&i.prototype),n.prototype.constructor=n,n.prototype.activate=function(t){var i=this;if("complete"===document.readyState)this.l(t);else{var n=new Promise((function(t){window.addEventListener("load",(function(){t()}))})),r=new Promise((function(t){setTimeout(t,4e3)}));Promise.race([n,r]).then((function(){i.l(t)}))}},n.prototype.deactivate=function(t){this.v(),t.removeEventListener("click",this.h),this.destroy()},n.prototype.l=function(t){(this.t=t,this.m=t.querySelector(".js-step3"),this.o=t.hasAttribute("data-my-avatar"),this.o)?(this.u(!1)||this.p(),this.t.addEventListener("click",this.h)):this.p()},n.prototype.j=function(){if(!this.t||!this.m)return 0;var i,n,r;try{i=this.m.getTotalLength(),n=this.t.viewBox.baseVal.width,r=this.t.clientWidth}catch(t){return this.O(this.t),0}return this.i=t.globalStore.isMobile?i:r/n*i,this.i},n.prototype.p=function(){if(this.t&&this.t.classList.contains(t.globalStore.externalCssClasses.ACTIVE)){this.P(!1);var i=this.t.querySelector(".js-step1"),n=this.t.querySelector(".js-step2"),r=this.t.querySelector("#dfAvatarCardGradient");l(this.j(),i,n,this.m,r)}},n.prototype.O=function(i){var n=this;if(!t.globalStore.isMobile){this.v();var r=document.getElementById("hook_Block_Avatar");if(r&&"function"==typeof MutationObserver){this.g=new MutationObserver((function(o){for(var u=0;u<o.length;u++)if("class"===o[u].attributeName&&!r.classList.contains(t.globalStore.externalCssClasses.HIDDEN)){n.l(i),n.v();break}})),this.g.observe(r,{attributes:!0,childList:!1,subtree:!1})}}},n.prototype.v=function(){this.g&&(this.g.disconnect(),this.g=null)},n.prototype.u=function(i){if(!this.o)return!1;var n=t.uploader.getUploading();if(!n.length&&!i)return!1;var r=n.filter((function(t){return t.isComplete()&&!t.isResolved()})).length,o=!!Object.values(this.store.uploadStatus).find((function(t){return!!t}));if(r||o)return this.P(!0),!0;if(this.P(!1),t.globalStore.isMobile){var u=n.filter((function(t){return!t.isResolved()})).map((function(t){return t.getOwnerId()}));if(u.length){var e=t.globalCtrl.splitUrl(window.location.search),s=e&&"1_"+e["st.groupId"];if(!u.some((function(t){return t===s})))return!1}}if(n.filter((function(t){return t.isResolved()})).length!==n.length){var f=n.reduce((function(t,i){return t+i.getVisualProgress()}),0);return this.k(f),!0}return n.filter((function(t){return t.isCommited()})).length===n.length&&this.m&&this.t&&(h(this.m),a(this.t)),!0},n.prototype.P=function(i){this.t&&this.m&&(i&&(h(this.m),a(this.t)),function(i,n){i.classList.toggle(t.globalStore.externalCssClasses.ERROR,n)}(this.t,i))},n.prototype.k=function(i){var n=this.j();n&&this.m&&this.t&&(s(this.m,n),this.m.style["stroke-dashoffset"]=String(n+(0-n)*i),this.t.classList.add(t.globalStore.externalCssClasses.PROGRESS))},n.prototype.errorLogger=function(t){o.default.clob("dailyphoto.avatar.error",t.stack,"DailyPhotoAvatar",t.message)},n}(i.AbstractWatcher);return u([i.watch((function(t){return t.store.uploads}))],d.prototype,"handleUploads",void 0),u([i.watch((function(t){return t.store.uploadStatus}))],d.prototype,"handleUploadStatus",void 0),d}(window.OK.dailyphoto.dailyphotoModel,window.OK.dailyphoto.quasiState);
