this.OK=this.OK||{},this.OK.dailyphoto=this.OK.dailyphoto||{},this.OK.dailyphoto.dailyphotoModel=function(t,n,i,e,o,r,u){"use strict";function c(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=c(n),s=c(i),f=c(o),h=c(r),l=c(u),d=function(t,n){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},d(t,n)};function v(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}d(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var p=function(){return p=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var o in n=arguments[i])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t},p.apply(this,arguments)};function w(t,n,i,e){var o,r=arguments.length,u=r<3?n:null===e?e=Object.getOwnPropertyDescriptor(n,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,n,i,e);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(u=(r<3?o(u):r>3?o(n,i,u):o(n,i))||u);return r>3&&u&&Object.defineProperty(n,i,u),u}function y(t,n){for(var i=0,e=n.length,o=t.length;i<e;i++,o++)t[o]=n[i];return t}function _(t){return Jt.hasVideo(t)?"video":"photo"}function m(t){return"stream"===t?"stream":"archive"}function g(t,n){return n?"promo":t===Wt.replyOwnerId?"reply":t===Wt.ratingOwnerId?"rating":Jt.isChallengeUser(t)?"challenge":t===Wt.myOwnerId?"self":"user"}function b(t){return Math.ceil(t/104857600)}function k(t,n){var i=["param0","param1","param2"],e={operation:t};n.forEach((function(t,n){e[i[n]]=String(t)})),a.default.success("dailyphoto.common",JSON.stringify(e))}var O={layerOpened:function(t){k("layer_opened",[t])},layerRequestContent:function(t){k("layer_request_content",[_(t)])},layerViewContent:function(t,n){t&&k("layer_view_content",[g(n,t.isPromo),_(t),!t.viewSummary.youReacted])},layerNavigateNextItem:function(t,n,i){k("layer_navigate_next_item",[t,g(n,i)])},layerNavigateNextUser:function(t,n){k("layer_navigate_next_user",["swipe",g(t,n)])},layerNavigateUserProfile:function(){k("layer_navigate_user_profile",[])},layerNavigateUserChat:function(){k("layer_navigate_user_chat",[])},layerContentError:function(t){k("layer_content_error",[t])},layerContentShowLoading:function(t,n){k("layer_content_show_loading",[_(t),n])},layerReactionPost:function(t,n,i,e,o){k("layer_reaction_post",[_(t),n,g(i,e),o])},layerReactionPostCustomSelected:function(t,n,i,e){k("layer_reaction_post_custom_selected",[_(t),n,g(i,e)])},layerReactionPostCustomOpenClick:function(){k("layer_reaction_post_custom_open_click",[])},layerReactionPostQuickSelected:function(t,n,i,e){k("layer_reaction_post_quick_selected",[_(t),n,g(i,e)])},layerReactionCounterClick:function(t){k("layer_reaction_counter_click",[t])},layerAnswerCounterClick:function(t){k("layer_answers_counter_click",[t])},layerBlockClick:function(t){k("layer_block_click",[t])},layerReplyListClick:function(){k("layer_reply_list_click",[])},layerReplySourceClick:function(){k("layer_reply_source_click",[])},portletRender:function(t){k("portlet_render",[t])},portletClick:function(t,n,i){var e=[t,n];i&&e.push(i),k("portlet_click",e)},portletContentClick:function(t,n,i,e,o,r){var u,c=g(t,n);switch(c){case"self":u="stream"===m(o)?"stream_content_click_self":"archive_content_click_self";break;case"reply":u="stream"===m(o)?"stream_content_click_reply":"archive_content_click_reply";break;case"user":u="stream"===m(o)?"stream_content_click_other":"archive_content_click_other";break;case"rating":u="stream"===m(o)?"stream_content_click_rating":"archive_content_click_rating";break;case"promo":u="stream"===m(o)?"stream_content_click_promo":"archive_content_click_promo"}var a="rating"===c?[e]:[i,e];r&&a.push(r),k(u,a)},extPortletContentClick:function(t,n,i,e,o){var r;switch(g(t,n)){case"user":r="stream_extended_content_click_other";break;case"promo":r="stream_extended_content_click_promo"}var u=[i,e];o&&u.push(o),k(r,u)},extPortletPlayingClick:function(t,n,i){var e=[t,n];i&&e.push(i),k("stream_extended_content_click_auto_play",e)},extPortletPlayingView:function(t,n,i,e){k("stream_extended_auto_play_view_content",[g(t,n),_(i),e])},extPortletRequestContent:function(t){k("stream_extended_auto_play_request_content",[_(t)])},extPortletNavigateNextItem:function(t,n,i){k("stream_extended_auto_play_navigate_next_item",[t,g(n,i)])},extPortletNavigateNextUser:function(t,n){k("stream_extended_auto_play_navigate_next_user",["swipe",g(t,n)])},extPortletContentError:function(t){k("stream_extended_auto_play_content_error",[t])},extPortletContentShowLoading:function(t,n){k("stream_extended_auto_play_content_show_loading",[_(t),n])},challengeOpened:function(t){k("challenge_opened",["sticker",t])},challengeSwitchTab:function(t){k("challenge_switch_tab",[t])},postingAddClick:function(t){k("posting_add_click",["stream"===t?"portlet":t])},postingSelectGalleryContent:function(t,n){k("posting_select_gallery_content",[t,n])},postingContentPublishSuccess:function(t,n,i){void 0===i&&(i=!1),k("posting_content_publish_success",[t,n,i])},postingContentPublishSuccessSource:function(t){k("posting_content_publish_success_source",[t])},postingPublishSlicedVideoSuccess:function(t){k("posting_publish_sliced_video_success",[t])},postingUploadError:function(t){k("posting_upload_error",[t])},postingUploadErrorType:function(t){k("posting_upload_error_type",[t])},postingUploadErrorSize:function(t,n){k("posting_upload_error_size",[t,b(n)])},postingUploadRetry:function(t){k("posting_upload_retry",[t])},postingUploadCancel:function(){k("posting_upload_cancel",[])},postingContentPublishPhotoSize:function(t){k("posting_content_publish_photo_size",[b(t)])},postingContentPublishGifSize:function(t){k("posting_content_publish_gif_size",[b(t)])},postingContentPublishVideoSize:function(t){k("posting_content_publish_video_size",[b(t)])},layerPostOverlayClick:function(){k("layer_post_overlay_click",[])},layerPostOverlayFollowClick:function(){k("layer_post_overlay_follow_click",[])},layerReplyWithMessageClick:function(){k("layer_reply_with_message_click",[])},layerReplyWithMessageRestrictedClick:function(){k("layer_reply_with_message_restricted_click",[])},layerReplyWithMessageSendClick:function(){k("layer_reply_with_message_send_click",[])},layerReplyWithMessageSendError:function(){k("layer_reply_with_message_send_error",[])},reshareClick:function(t){k("reshare_click",[t])},layerPromoActionClick:function(t,n){k("layer_promo_action_click",[t,n])},layerFinishViewContent:function(t){k("layer_finish_view_content",[t,"video"])}},S=function(){function t(t,n,i){var e=this;this.t=0,this.i=0,this.o=0,this.u=!1,this.h=i,this.mediaId=n,this.l=t,this.v=new Image,this.v.onload=function(){return e.p()},this.v.onerror=function(){return e._()},this.m()}return t.prototype.g=function(){var t=this.o?"?".concat(this.o):"";return this.l+t},t.prototype.m=function(){this.u=!1,this.v.src=this.g()},t.prototype.retry=function(){this.u&&(this.o+=1,this.m())},t.prototype.abort=function(){this.v.onerror=null,this.v.src=""},t.prototype._=function(){var n=this;this.u=!0,this.t<t.MAX_RETRY_COUNT?(this.i=window.setTimeout((function(){return n.retry()}),Math.pow(this.t,t.RETRY_TIME_POWER)*t.RETRY_TIME_SECONDS),this.t+=1):O.layerContentError("network")},t.prototype.p=function(){window.clearTimeout(this.i),this.u=!0,this.h(this.g())},t.MAX_RETRY_COUNT=10,t.RETRY_TIME_POWER=2,t.RETRY_TIME_SECONDS=1e3,t}(),P=function(){function t(){var t=this;this.k=!0,this.O=!0,this.S=!0,this.P=[],this.C=function(){t.S!==navigator.onLine&&(t.S=navigator.onLine,t.S?t.P.forEach((function(t){t.retry()})):t.M())};var n=document.createElement("video");this.k=""!==n.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),this.O=""!==n.canPlayType("video/webm"),window.addEventListener("online",this.C),window.addEventListener("offline",this.C)}return t.prototype.load=function(t){t&&(this.P.filter((function(n){return n.mediaId===t.mediaId})).forEach((function(t){return t.retry()})),0===t.getLoaded()&&(this.j(t),t.setLoaded(1),(Jt.hasVideo(t)?this.R(t):this.T(t)).then((function(){t.setLoaded(2)})).catch((function(){}))))},t.prototype.destroy=function(){this.M(),this.P.length=0},t.prototype.M=function(){this.P.forEach((function(t){t.abort()}))},t.prototype.j=function(t){t.getMp4Src()&&!this.k&&t.setMp4Src(void 0),t.getWebMSrc()&&!this.O&&t.setWebMSrc(void 0)},t.prototype.N=function(t,n){var i=this.P.indexOf(t);this.P.splice(i,1),n()},t.prototype.L=function(t,n){var i=this,e=t["get"+n],o=t["set"+n],r=e();return new Promise((function(n,e){if(r&&1===t.getLoaded()){var u=new S(r,t.mediaId,(function(t){o(t),i.N(u,n)}));i.P.push(u)}else e()}))},t.prototype.T=function(t){var n=this.L(t,"PhotoSrc"),i=this.L(t,"PhotoBlurredSrc");return performance.now(),Promise.all([n,i])},t.prototype.R=function(t){var n=this.L(t,"PhotoBlurredSrc");return performance.now(),Promise.all([n])},t}(),C=window.devicePixelRatio>1?"@2x":"",E="//st.mycdn.me/static/emoji/".concat("3-0-4"),M=/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff]|\u200D|[\uFE00-\uFE0F])/g;function j(t){return t>=55296&&t<=56319}function R(t){return t>=56320&&t<=57343}function T(t){return t>=65024&&t<=65039}function N(t){return!T(t)&&8205!==t}function L(t){return["🏻","🏼","🏽","🏾","🏿"].includes(t)}function x(t){return 917631===t}function A(t){for(var n=[],i=0,e=t.length,o=void 0,r=void 0;i<e;i++)j(o=t.charCodeAt(i))&&e>i+1&&R(r=t.charCodeAt(i+1))?(n.push(1024*(o-55296)+r-56320+65536),i++):n.push(o);return n}function U(t){return t.toString(16)}var H,I={getCodePoints:A,toString:U,getEmojiUrl:function(t,n){if(void 0===n&&(n=20),t)return"".concat(E,"/").concat(n,"/").concat(function(t){var n=A(t).filter(N).map(U).join("-");return"".concat(n).concat(C,".png")}(t))},parseString:function(t){var n=[],i=t.match(M);if(!i)return n;for(var e,o=i.join(""),r="",u="",c=!1,a=!1,s=0,f=o.length;s<f;++s){var h=o.charCodeAt(s);if(a=!!r.length,T(h))a&&(r+=o.charAt(s));else if(8205!==h)if(!c&&a&&(n.push(r),r=""),c=!1,j(h)&&f>s+1&&R(h=o.charCodeAt(s+1))){var l=o.slice(s,s+2),d=A(l)[0];if((e=d)>=127462&&e<=127487){u?(r+=u+l,u=""):u=l,++s;continue}if(x(d)){var v=n.lastIndexOf("🏴");if(-1!==v){var p=n.splice(v).join("")+l;n.push(p),++s;continue}}L(l)&&n.length?n[n.length-1]+=l:r+=l,++s}else r+=o.charAt(s);else c=!0,r+=o.charAt(s)}return r.length&&n.push(r),n}},F="dailyphoto",q=function(){function t(){this.A={},this.U(),this.H(),this.I(this.A)}return t.prototype.U=function(){var t=localStorage.getItem(F);if(t)try{for(var n in this.A=JSON.parse(t),this.A)this.A.hasOwnProperty(n)&&(Wt.allowedStorageKeys.includes(n)||delete this.A[n])}catch(t){}},t.prototype.H=function(){var t=this;Wt.allowedStorageKeys.forEach((function(n){if(!t.A.hasOwnProperty(n))switch(n){case"show_challenge_badge_bubble":case"show_post_overlay_bubble":t.A[n]=!0}}))},t.prototype.I=function(t){try{var n=JSON.stringify(t);localStorage.setItem(F,n),this.A=t}catch(t){}},t.prototype.getItem=function(t){return this.A[t]},t.prototype.setItem=function(t,n){var i,e=p(p({},this.A),((i={})[t]=n,i));this.I(e)},t}(),V=function(){function t(){this.successCallback=[],this.failCallback=[]}return t.prototype.success=function(t){return this.isResolved()&&!this.errorValue?t(this.resultValue):this.successCallback.push(t),this},t.prototype.fail=function(t){return this.isResolved()&&this.errorValue?t(this.errorValue):this.failCallback.push(t),this},t.prototype.cleanQueue=function(){return this.successCallback.length=0,this.failCallback.length=0,this},t.prototype.runSuccessQueue=function(){var t=this;this.successCallback.forEach((function(n){return n(t.resultValue)})),this.cleanQueue()},t.prototype.runFailQueue=function(){var t=this;this.failCallback.forEach((function(n){return n(t.errorValue)})),this.cleanQueue()},t}(),K=function(t){function n(n,i,e){var o=t.call(this)||this;return o.F=0,o.q=0,o.V=!1,o.K=!1,o.t=0,o.i=0,o.D=i.id,o.l=i.url,o.B=n,o.q=o.B.size,o.W=e,o}return v(n,t),Object.defineProperty(n.prototype,"xhr",{get:function(){return this.J},enumerable:!1,configurable:!0}),n.prototype.abort=function(){return window.clearTimeout(this.i),this.t=0,this.cleanQueue(),this.inProgress()&&(this.xhr.abort(),this.K=!1),this},n.prototype.isResolved=function(){return this.V},n.prototype.inProgress=function(){return this.K},n.prototype.start=function(){var t=this;if(this.inProgress()||this.isResolved())return this;this.K=!0;var n=Math.min(this.F+3276800,this.q);return this.J=new XMLHttpRequest,this.J.open("POST",this.l),this.J.setRequestHeader("Content-Type","application/octet-stream"),this.J.setRequestHeader("Content-Range","bytes ".concat(this.F,"-").concat(n-1,"/").concat(this.q)),this.J.onload=function(){return t.G()},this.J.onerror=function(){return t._()},this.J.ontimeout=function(){return t._()},this.J.upload.onprogress=function(n){return t.W(t.F+n.loaded,t.q)},this.J.send(this.B.slice(this.F,n)),this},n.prototype.G=function(){if(this.X(),!this.Y()){if(this.xhr.getResponseHeader("X-Last-Known-Byte"))return this.t&&a.default.success("dailyphoto.upload.retry-count",String(this.t)),this.t=0,void this.start();try{if(this.resultValue=JSON.parse(this.xhr.responseText),this.V=!0,this.resultValue.error_code){var t=this.resultValue.error_data||this.resultValue.error_code;return a.default.clob("dailyphoto.upload.error",this.xhr.responseText,"UploadRequest",t),void this.$(t)}this.runSuccessQueue()}catch(t){var n=t;a.default.clob("dailyphoto.upload.error",this.xhr.responseText,"UploadRequest",n.message),this.$(n)}}},n.prototype.Z=function(){return window.clearTimeout(this.i),this.start()},n.prototype._=function(){var t=this;this.X(),this.Y()||(this.t<n.MAX_RETRY_COUNT?(this.i=window.setTimeout((function(){return t.Z()}),Math.pow(this.t,n.RETRY_TIME_POWER)*n.RETRY_TIME_SECONDS),this.t+=1,O.postingUploadRetry("upload")):(a.default.clob("dailyphoto.upload.error",this.xhr.responseText,"UploadRequest","Retry count exceed"),this.$("Retry count exceed")))},n.prototype.X=function(){var t=this.xhr.getResponseHeader("X-Last-Known-Byte");t&&(this.F=Number(t)+1),window.clearTimeout(this.i),this.K=!1},n.prototype.Y=function(){return!(this.xhr.status>=200||this.xhr.status<300)&&(this.xhr.getResponseHeader("X-Last-Known-Byte")||(this.F=0),a.default.clob("dailyphoto.upload.error",this.xhr.responseText,"UploadRequest",String(this.xhr.status)),this.$("Process error: code ".concat(this.xhr.status)),!0)},n.prototype.$=function(t){this.errorValue=t,this.runFailQueue(),O.postingUploadError("upload")},n.MAX_RETRY_COUNT=10,n.RETRY_TIME_POWER=2,n.RETRY_TIME_SECONDS=1e3,n}(V),D=function(t){function n(i,e,o){void 0===o&&(o=n.MAX_RETRY_COUNT);var r=t.call(this)||this;return r.V=!1,r.tt=!1,r.K=!1,r.t=0,r.i=0,r.nt=i,r.it=e||{},r.et=o,r.ot=new AbortController,r}return v(n,t),n.prototype.start=function(t){var n=this;return this.inProgress()||this.isResolved()||(t||(this.t=0),this.K=!0,B().then((function(t){t.invoke(n.nt,n.it,{signal:n.ot.signal}).then((function(t){n.resultValue=t,n.V=!0,n.K=!1,n.runSuccessQueue(),n.t&&a.default.success("dailyphoto.request.retry-count",String(n.t))}),(function(t){if(n.K=!1,"SERVER_ERROR"===t.typeName&&n.t<n.et)return n._();n.errorValue=t,n.tt=!0,n.runFailQueue()}))}))),this},n.prototype.abort=function(){return window.clearTimeout(this.i),this.cleanQueue(),this.inProgress()&&this.ot.abort(),this},n.prototype.withRetryCallback=function(t){return this.rt=t,this},n.prototype.result=function(){var t=this;return new Promise((function(n,i){t.success(n),t.fail(i)}))},n.prototype.isResolved=function(){return this.V},n.prototype.isRejected=function(){return this.tt},n.prototype.inProgress=function(){return this.K},n.prototype.Z=function(){return window.clearTimeout(this.i),"function"==typeof this.rt&&this.rt(),this.start(!0)},n.prototype._=function(){var t=this;window.clearTimeout(this.i),this.i=window.setTimeout((function(){return t.Z()}),Math.pow(this.t,n.RETRY_TIME_POWER)*n.RETRY_TIME_SECONDS),this.t+=1},n.MAX_RETRY_COUNT=10,n.RETRY_TIME_POWER=2,n.RETRY_TIME_SECONDS=1e3,n}(V),z=function(t,n,i){return new D(t,n,i)},B=function(){return H||(H=Wt.isMobile&&window.OK.dailyphoto?window.OK.dailyphoto.import("webapi"):Jt.require("OK/webapi")),H},W=0;function J(t){return"".concat(t,"-").concat(W++)}function G(t,n){var i=(t/n).toFixed(1);return-1!==i.indexOf(".0")?i.slice(0,-2):i}var X=function(){function t(t,n,i,o,r){var u=this;this.loaded=0,this.total=0,this.u=!1,this.ut=!1,this.ct=[],this.B=t,this.blocks=n,this.type=t.type,this.total=t.size,this.at=r,this.st=i,this.ft=o,this.uploadTaskId=String(J("task")),this.ht=f.default(100,(function(t){var n;e.extendObservable(Wt.uploads,((n={})[u.uploadTaskId]=t,n),!0)})),window.URL&&window.URL.createObjectURL&&(this.previewURL=window.URL.createObjectURL(t)),this.lt()&&navigator.onLine&&this.start()}return t.prototype.start=function(){var t=this;this.lt()&&this.dt().success((function(){t.vt&&t.wt().success((function(){return t.yt()}))}))},t.prototype.abort=function(){window.clearTimeout(this._t);var t=this.gt();return t&&t.inProgress()&&t.abort(),this},t.prototype.destroy=function(){var t;this.u=!1,this.previewURL&&window.URL&&window.URL.revokeObjectURL&&window.URL.revokeObjectURL(this.previewURL),this.abort();var n=this.gt();return n&&n.abort(),Wt.uploadStatus[this.uploadTaskId]&&e.extendObservable(Wt.uploadStatus,((t={})[this.uploadTaskId]=void 0,t),!0),this.ht(void 0),this.at(!0),this},t.prototype.result=function(){return this.bt},t.prototype.isComplete=function(){return this.u},t.prototype.isResolved=function(){return this.isComplete()&&!this.errorText},t.prototype.isCommited=function(){return this.ut},t.prototype.setCommited=function(){this.ut=!0,this.ht(this)},t.prototype.getArchiveCards=function(){return this.ct},t.prototype.getOwnerId=function(){return this.ft},t.prototype.setArchiveCards=function(t){this.ct=t},t.prototype.setError=function(t){var n;this.errorText=t,this.u=!0,e.extendObservable(Wt.uploadStatus,((n={})[this.uploadTaskId]=t,n),!0),this.ht(this)},t.prototype.getVisualProgress=function(){return this.isCommited()?1:this.loaded/this.total*.9+.05},t.prototype.retry=function(){return this.ut||this.start(),this},t.prototype.lt=function(){this.u=!1,this.errorText="";var t,n=Wt.maxUploadFileSize[this.B.type];return n?n<this.B.size?(O.postingUploadErrorSize(this.B.type,this.B.size),this.setError(h.default.getLMsg("upload-type-size-exceeded",{size:(t=n,t>=1048576?"".concat(G(t,1048576),"MB"):t>=1024?"".concat(G(t,1024),"KB"):String(t))})),!1):(this.ht(this),!0):(O.postingUploadErrorType(this.B.type),this.setError(h.default.getLMsg("upload-type-disabled")),!1)},t.prototype.gt=function(){return this.kt&&!this.kt.isResolved()?this.kt:this.Ot&&!this.Ot.isResolved()?this.Ot:this.St&&!this.St.isResolved()?this.St:this.Pt&&!this.Pt.isResolved()?this.Pt:void 0},t.prototype.Ct=function(){this.u=!0,this.ht(this),this.at(!1)},t.prototype.Et=function(){return this.kt||(this.kt=z("dailyphoto/getUploadUrl",p({isVideo:Jt.hasUploadTaskVideo(this),origin:this.st},this.ft&&{ownerId:this.ft}))),this.kt},t.prototype.dt=function(){var t=this;return this.kt&&this.kt.isResolved()?this.kt.cleanQueue():this.Et().cleanQueue().start().success((function(n){if(!n.success)return t.setError(n.code||h.default.getLMsg("upload-error"));t.vt=n.token,t.mediaId=t.vt.id,t.encodedPhotoId=t.vt.encodedPhotoId})).fail((function(n){t.setError(h.default.getLMsg("upload-error")),n instanceof Error&&a.default.clob("dailyphoto.upload.error",n.stack,"UploadTask",n.message)}))},t.prototype.Mt=function(){var t=this;return this.Ot||(this.Ot=new K(this.B,this.vt,(function(n,i){t.total=i,t.loaded=n,t.ht(t)}))),this.Ot},t.prototype.wt=function(){var t=this;return this.Ot&&this.Ot.isResolved()?this.Ot.cleanQueue():this.Mt().cleanQueue().start().success((function(n){t.jt=n,Jt.hasUploadTaskVideo(t)||(t.bt=t.Rt(n))})).fail((function(n){t.setError(h.default.getLMsg("upload-error")),n instanceof Error&&a.default.clob("dailyphoto.upload.error",n.stack,"UploadRequest",n.message)}))},t.prototype.yt=function(){var t=this;if(!Jt.hasUploadTaskVideo(this))return this.Ct();this.Tt(this.jt.params.token).start().success((function(n){if(!n.success)return t.setError(n.code||h.default.getLMsg("upload-error"));t.Nt(n.token,(function(n){t.bt=t.Rt(n),t.Ct()}))})).fail((function(n){t.setError(h.default.getLMsg("upload-error")),O.postingUploadError("processing"),n instanceof Error&&a.default.clob("dailyphoto.upload.error",n.stack,"UploadTask",n.message)}))},t.prototype.Rt=function(t){return Jt.hasUploadTaskVideo(this)?t.parts:[{mediaId:this.mediaId,token:t.photos[this.encodedPhotoId].token}]},t.prototype.Tt=function(t){return this.St||(this.St=z("dailyphoto/startSplitPhotos",{token:t}).withRetryCallback((function(){O.postingUploadRetry("processing")}))),this.St},t.prototype.Lt=function(t){return this.Pt=z("dailyphoto/awaitSplitPhotos",{token:t}).withRetryCallback((function(){O.postingUploadRetry("processing")})),this.Pt},t.prototype.Nt=function(t,n){var i=this;this.Lt(t).start().success((function(e){if(!e.success)return i.setError(e.code||h.default.getLMsg("upload-error"));e.complete?n(e):i._t=window.setTimeout((function(){i.Nt(t,n)}),5e3)})).fail((function(t){i.setError(h.default.getLMsg("upload-error")),O.postingUploadError("processing"),t instanceof Error&&a.default.clob("dailyphoto.upload.error",t.stack,"UploadTask",t.message)}))},t}(),Q=function(){function t(t,n,i,e,o){var r=this;this.xt=[],this.At=J("commit"),this.st=i,this.ft=e,this.xt=t.map((function(t,o){var u=new X(t,n[o],i,e,(function(t){if(t){var n=r.xt.indexOf(u);-1!==n&&r.xt.splice(n,1)}r.lt()}));return u})),this.at=o;var u=this.getContentType(this.xt);u&&O.postingSelectGalleryContent(u,t.length)}return t.prototype.cancel=function(){this.abort(),this.xt.filter((function(t){return!t.isCommited()})).forEach((function(t){O.postingUploadCancel(),t.destroy()}))},t.prototype.abort=function(){this.xt.forEach((function(t){t.abort()})),this.Ut&&this.Ut.abort()},t.prototype.retry=function(){this.xt.forEach((function(t){t.isComplete()||t.retry()})),this.lt()},t.prototype.isResolved=function(){return!this.xt.length||!!this.xt.length&&this.xt.every((function(t){return t.isCommited()}))},t.prototype.getTasks=function(){return this.xt},t.prototype.getContentType=function(t){return t.every((function(t){return Jt.hasUploadTaskVideo(t)}))?"video":t.some((function(t){return Jt.hasUploadTaskVideo(t)}))?"multiple":t.length?"photo":void 0},t.prototype.Ht=function(){var t;Wt.uploadStatus[this.At]&&e.extendObservable(Wt.uploadStatus,((t={})[this.At]=void 0,t),!0)},t.prototype.lt=function(){if(!this.xt.length)return this.Ht(),void this.at();if(this.xt.every((function(t){return t.isComplete()}))){var t=this.xt.filter((function(t){return t.isResolved()&&!t.isCommited()}));t.length&&this.It(t)}},t.prototype.It=function(t){var n=this,i=t.map((function(t){return t.result()})).reduce((function(t,n){return t.concat(n)}),[]),o=t.reduce((function(t,n){var i;return Object.assign(t,((i={})[n.mediaId]=n.blocks,i))}),{});this.Ut=this.Ft(i.map((function(t){return t.token})),o),this.Ut.success((function(i){var o;if(i.success){var r=Wt.isLayerOpen,u=i.photos.map((function(t){return t.id})),c=i.photos.reduce((function(t,n,e){return t[n.id]=i.archiveCards[e],t}),{});t.forEach((function(t){var i=t.result();if(i.every((function(t){return u.includes(t.mediaId)}))){t.setArchiveCards(i.map((function(t){return{mediaId:t.mediaId,card:c[t.mediaId]}}))),t.setCommited();var e=t.total/1024;if(Jt.hasUploadTaskVideo(t)){O.postingContentPublishVideoSize(e);var o=t.result().length;o>1&&O.postingPublishSlicedVideoSuccess(o)}else"image/gif"===t.type?O.postingContentPublishGifSize(e):O.postingContentPublishPhotoSize(e);if(!r){var a=n.xt.indexOf(t);n.xt.splice(a,1)}}})),i.code&&t.filter((function(t){return!t.isCommited()})).forEach((function(t){return t.setError(i.code)}));var a=n.getContentType(t.filter((function(t){return t.isCommited()})));a&&O.postingContentPublishSuccess(a,u.length),O.postingContentPublishSuccessSource(n.st),(!Wt.isMobile||n.ft&&!Jt.isGroup(n.ft))&&Jt.updateMainAvatar(n.ft||void 0),r||n.at()}else{var s=i.code||h.default.getLMsg("upload-error");e.extendObservable(Wt.uploadStatus,((o={})[n.At]=s,o),!0)}})).fail((function(t){var i;O.postingUploadError("commit");var o=t;t instanceof Error&&(o=t.message,a.default.clob("dailyphoto.upload.error",t.stack,"UploadCommit",t.message)),e.extendObservable(Wt.uploadStatus,((i={})[n.At]=o,i),!0)}))},t.prototype.Ft=function(t,n){return z("dailyphoto/commitPhotos",p({tokens:t,blocks:n,origin:this.st},this.ft&&{ownerId:this.ft})).withRetryCallback((function(){O.postingUploadRetry("commit")})).cleanQueue().start()},t}(),Y=function(){function t(){var t=this;this.qt=[],this.Vt=function(){for(var n=t.qt.length;n>0;n--){t.qt[n-1].isResolved()&&t.qt.splice(n-1,1)}},this.C=function(){navigator.onLine?t.qt.forEach((function(t){t.retry()})):t.qt.forEach((function(t){t.abort()}))},window.addEventListener("online",this.C),window.addEventListener("offline",this.C)}return t.prototype.upload=function(t,n,i,e){void 0===e&&(e=null),null==n&&(n=t.map((function(){return[]})));var o=e||Wt.myOwnerId;this.qt.push(new Q(t,n,i,o,this.Vt))},t.prototype.cancelAll=function(){for(var t=this.qt.length;t--;)this.qt[t].cancel()},t.prototype.cancel=function(t){var n=Wt.uploads[t];n&&(n.destroy(),O.postingUploadCancel())},t.prototype.getUploading=function(){return this.qt.reduce((function(t,n){return y(y([],t),n.getTasks())}),[])},t}(),$=function(){function t(){var t=this;this.Kt=function(){},this.Dt=function(){},this.resolve=function(n){t.Kt(n)},this.reject=function(n){t.Dt(n)},this.zt=new Promise((function(n,i){t.Kt=n,t.Dt=i}))}return Object.defineProperty(t.prototype,"promise",{get:function(){return this.zt},enumerable:!1,configurable:!0}),t}(),Z="OK/NonBlockingTip",tt="OK/ShortcutMenuAdapter",nt="OK/uuid",it=new(function(){function t(){}return t.prototype.getNonBlockingTip=function(){return this.Bt||(this.Bt=new Promise((function(t,n){(Wt.isMobile&&window.OK.dailyphoto?window.OK.dailyphoto.import(Z):Jt.require(Z)).then((function(n){t({create:function(t){Wt.isMobile?n.create(t):n.create({message:t,visibleTime:3e3})}})})).catch(n)}))),this.Bt},t.prototype.getShortcutMenuAdapter=function(){return this.Wt||(this.Wt=Wt.isMobile&&window.OK.dailyphoto?window.OK.dailyphoto.import(tt):Jt.require(tt)),this.Wt},t.prototype.getUUID=function(){return this.Jt||(this.Jt=Wt.isMobile&&window.OK.dailyphoto?window.OK.dailyphoto.import(nt):Jt.require(nt)),this.Jt},t}());function et(t,n){try{return t()}catch(t){var i=t;a.default.clob("dailyphoto.global.error",i.stack,n,n+": "+i.message)}}function ot(t){return new Promise((function(n){window.require([t],(function(t){n(t)}))}))}function rt(t){return window.OK.dailyphoto?window.OK.dailyphoto.parseJSONCorrected(t):window.OK.util.parseJsonCorrected(t)}function ut(t){return _t.root?_t.styles[t]?Promise.resolve(_t.styles[t]):new Promise((function(n){var i=function(t){var n;n=Wt.isMobile&&window.OK.dailyphoto?window.OK.dailyphoto.getImportUrl(t):window.require.toUrl(t);var i=n.split("/");return i.pop(),i.join("/")+"/index.css"}(t),e=document.createElement("link");if(e.onload=function(){_t.styles[t]=e,n(e)},e.rel="stylesheet",e.href=i,_t.root.appendChild(e),!_t.root.mode&&t===yt){var o=new Image;o.onerror=function(){window.getComputedStyle(_t.root,":before").length&&(_t.styles[t]=e,n(e))},o.src=i}})):Promise.reject()}function ct(){return _t.layerPreload||(_t.layerPreload=Promise.all([Wt.isMobile&&window.OK.dailyphoto?window.OK.dailyphoto.import(yt):ot(yt),ut(yt)]),B()),_t.layerPreload}function at(t,n){et((function(){var i={};t.forEach((function(t){var o=t.mediaId,r=p(p({},t),function(t){var n;t.blocks&&t.blocks.length&&(n=t.blocks.find((function(t){return 0===t.type||1===t.type})));var i={getMp4Src:function(){},getWebMSrc:function(){},getHasSound:function(){return!1},getLoaded:function(){return 3}};if(!n)return i;n.loaded=0;var o=e.observable(n);return{getPhotoSrc:function(){return o.photoSrc},setPhotoSrc:function(t){return o.photoSrc=t},getPhotoBlurredSrc:function(){return o.photoBlurredSrc},setPhotoBlurredSrc:function(t){return o.photoBlurredSrc=t},getLoaded:function(){return o.loaded},setLoaded:function(t){return o.loaded=t},getLoadedObservable:function(){return o.getModel().loaded},getMp4Src:function(){return o.mp4Src},setMp4Src:function(t){return o.mp4Src=t},getWebMSrc:function(){return o.webmSrc},setWebMSrc:function(t){return o.webmSrc=t},getHasSound:function(){return o.hasSound},setHasSound:function(t){return o.hasSound=t}}}(t));if(_t.photos[o]){var u=_t.photos[o];if(Array.isArray(n))return void n.forEach((function(t){u.set(t,r[t])}));["_index","replyToMediaId","replyOriginalPreviewSrc","publicReply","replyOriginalUnavailableReason","replyOriginalOwnerId","newReaction","newEventsCount","width","height","mediaKey","moderationKey","challengeDenied","challengeModerated","commitId","commitTime","isExpired","isPromo","answersCount","hasNewAnswers","textReactions","isAuthor"].forEach((function(n){t[n]&&!u[n]&&u.set(n,t[n])})),r.getMp4Src()&&!u.getMp4Src()&&u.setMp4Src(r.getMp4Src()),r.getWebMSrc()&&!u.getWebMSrc()&&u.setWebMSrc(r.getWebMSrc()),r.getHasSound()&&!u.getHasSound()&&u.setHasSound(r.getHasSound()),t.ownerId&&!u.ownerId&&(u.ownerId=t.ownerId),void 0!==t.newViewsCount&&(void 0===u.newViewsCount||u.newViewsCount<1)&&(u.newViewsCount=t.newViewsCount),u.blocks&&r.blocks&&u.blocks.length<r.blocks.length&&u.blocks.set(r.blocks),u.viewSummary&&u.viewSummary.set(t.viewSummary),u.voteSummary&&u.voteSummary.set(t.voteSummary),u.hasNewAnswers&&(u.hasNewAnswers=t.hasNewAnswers)}else i[o]=e.observable(r),Object.assign(i[o],{publishTimeMillis:Number(t.publishTimeMillis),endTimeMillis:Number(t.endTimeMillis),duration:pt.hasVideo(r)?0:_t.slideChangeTimeout})})),e.extendObservable(_t.photos,i,!0)}),"appendPhotos")}function st(t){var n=null==t?void 0:t.blocks;return n&&n.find((function(t){return 8===t.type}))}function ft(t){return t.startsWith("".concat(1,"_"))}function ht(t){var n=t.toString();return-1!==n.indexOf("_")?n.substring(2):n}function lt(t){return t&&(t.getMp4Src()||t.getWebMSrc())}function dt(){try{return window.OK.getCurrentStateLink()}catch(t){}return"/?st.cmd=userMain"}var vt,pt={preloadLayer:ct,openLayer:function(t){ct().then((function(n){var i=n[0].create;et((function(){if(!_t.layer&&_t.root){_t.layer=i(t);var n=_t.layer.getRoot();_t.root.appendChild(n),Wt.isMobile||(window.OK.Layers&&(window.OK.Layers.onLayerShown(),window.OK.Layers.register(wt,cn)),_t.root.mode&&n&&s.default.activate(n))}}),"openLayer")})).catch((function(t){a.default.clob("dailyphoto.global.error",t.stack,"preloadLayer","preloadLayer: "+t.message)}))},preloadPhoto:function(t){et((function(){var n=t.currentTarget.querySelector(".js-photo-model");if(n){var i=rt(n.innerHTML);at([i]),Xt.load(_t.photos[i.mediaId])}}),"preloadPhoto")},appendPhotos:at,deletePhoto:function(t){et((function(){_t.photos[t]&&_t.photos.set(t,void 0,!0)}),"deletePhoto")},startTimer:function(t){et((function(){if(!_t)throw"Store absent";if(!performance)throw"Performance not defined";_t.timers[t]=performance.now()}),"startTimer")},endTimer:function(t,n,i){et((function(){if(_t.timers[t]){var e=Math.round(performance.now()-_t.timers[t]);a.default.duration("dailyphoto.timer."+t,e,n,i),_t.timers[t]=0}}),"endTimer")},endTimerPercentage:function(t,n){et((function(){if(_t.timers[t]){var i=Math.round(performance.now()-_t.timers[t]),e=Math.min(10*Math.ceil(i/n*10),100),o=Math.max(e-10,0);Gt.layerFinishViewContent("".concat(o,"-").concat(e)),_t.timers[t]=0}}),"endTimer")},getOwnerId:function(t){return"".concat(0,"_").concat(t)},getChallengeFromPhoto:st,isChallengePhoto:function(t){return!!st(t)},isChallengeUser:function(t){return!!t&&t.startsWith("".concat(4,"_"))},ownerIsGroup:function(t){return ft(t.uid)},isGroup:ft,getPureId:ht,getChallengeOwner:function(t){return"".concat(4,"_").concat(t)},createComposedPhotoId:function(t,n){return{mediaId:t,ownerId:n}},isVertical:function(t,n,i){if(!t.width||!t.height)return!0;var e=n/i,o=t.width/t.height;return Math.abs(e-o)<=.075},getVideoSrc:lt,hasVideo:function(t){return!!lt(t)},hasUploadTaskVideo:function(t){return"video/mp4"===t.type||"video/webm"===t.type||"video/quicktime"===t.type||"video/3gpp"===t.type},getCurrentStateLink:dt,updateMainAvatar:function(t){if(Wt.isMobile){var n=(null==t?void 0:t.toString().startsWith("".concat(1,"_")))?"&groupId=".concat(ht(t)):"";l.default.ajax({url:"/dk?st.cmd=userProfileAvatarUpdater".concat(n)}).then((function(t){l.default.updateBlockModelCallback(t)}))}else l.default.ajax({url:dt()+"&cmd=Avatar"}).then((function(t){l.default.updateBlockModelCallback(t)}))},sanitize:function(t){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return t.replace(/[&<>"'/]/gi,(function(t){return n[t]}))},parseOKJson:rt,wrapErrorLogger:et,require:ot,getCss:ut,splitUrl:function(t){var n=t.indexOf("?");return t.slice(n+1).split("&").reduce((function(t,n){var i=n.split("=");return t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]),t}),{})}};var wt="dailyphoto",yt="dailyphoto-layer",_t=new(function(t){function n(){var n,i=t.call(this)||this;return i.root=(n=document.getElementById("dailyphoto-layer"),pt.wrapErrorLogger((function(){if(document.head.attachShadow&&n)return n.attachShadow({mode:"open",delegatesFocus:!1})}),"modelCreateRoot")||n),i.styles={},i.slideChangeTimeout=1e4,i.myId="",i.replyOwnerId="3_1",i.ratingOwnerId="3_2",i.allowedReactions="",i.version="",i.allowedStorageKeys=[],i.maxUploadFileSize={},i.customReactions=!1,i.sendMessageEnabled=!1,i.autoplayScrollStartTimeout=0,i.isMobile=!1,i.timers={},i.externalCssClasses={},i.maxNewAnswers=10,i.isChallengeAdmin=!1,i.isLayerOpen=e.observable(!1),i.users=e.observable({}),i.photos=e.observable({}),i.uploads=e.observable({}),i.uploadStatus=e.observable({}),i.externalReaction=e.observable({}),i.isPlayerActive=e.observable(!1),i.Gt(),i}return v(n,t),n.prototype.Gt=function(){var t=this;pt.wrapErrorLogger((function(){var n=document.getElementById("dailyphoto-config");if(n){var i=pt.parseOKJson(n.innerHTML);t.slideChangeTimeout=i.slideChangeTimeout,t.allowedReactions=i.allowedReactions,t.myId=i.myId,t.myOwnerId=pt.getOwnerId(t.myId),t.version=i.version,t.allowedStorageKeys=i.allowedStorageKeys||[],t.maxUploadFileSize=i.maxUploadFileSize||{},t.customReactions=i.customReactions||!1,t.autoplayScrollStartTimeout=i.autoplayScrollStartTimeout||0,t.isMobile=i.isMobile||!1,t.externalCssClasses=i.externalCssClasses,t.sendMessageEnabled=i.sendMessageEnabled||!1,t.maxNewAnswers=i.maxNewAnswers,t.isChallengeAdmin=i.isChallengeAdmin||!1}}),"modelConfig")},w([e.watched],n.prototype,"isLayerOpen",void 0),w([e.watched],n.prototype,"users",void 0),w([e.watched((vt={},vt[e.HIDE_FREQUENCY_CHECK]=!0,vt))],n.prototype,"photos",void 0),w([e.watched],n.prototype,"uploads",void 0),w([e.watched],n.prototype,"uploadStatus",void 0),w([e.watched],n.prototype,"externalReaction",void 0),w([e.watched],n.prototype,"isPlayerActive",void 0),n}(e.AbstractStore)),mt="mouseup",gt="mousedown",bt="mousemove",kt=_t.isMobile&&"ontouchend"in window;kt&&(mt="touchend",gt="touchstart",bt="touchmove");var Ot=mt,St=gt,Pt=bt,Ct="mouseenter",Et="mouseleave",Mt=[];function jt(t,n,i,e){return Mt.find((function(o){return o.element===t&&o.primaryHandler===n&&o.secondaryHandler===i&&o.thirdHandler===e}))}function Rt(t,n){return Nt(t).clientX-Nt(n).clientX}function Tt(t,n){return Nt(t).clientY-Nt(n).clientY}function Nt(t){return t instanceof MouseEvent?t:t.touches.length?t.touches[0]:t.changedTouches[0]}function Lt(t){return t instanceof MouseEvent&&!!t.button}function xt(t){return!!(kt&&t instanceof TouchEvent)&&t.touches.length>1}function At(t){t.preventDefault()}function Ut(t){if(t)for(var n in t)t.hasOwnProperty(n)&&(t[n]=void 0)}function Ht(t,n,i){var e={downEvent:undefined,moveEvent:undefined,downTimeout:undefined,target:undefined,largeMove:!1};if(!jt(t,n,i)){var o={element:t,type:0,primaryHandler:n,secondaryHandler:i,firstHandler:function(n){Lt(n)||xt(n)||(e.downEvent=n,e.moveEvent=void 0,e.largeMove=!1,e.target=n.target,i&&(t.oncontextmenu=At),"function"==typeof i&&(e.downTimeout=window.setTimeout((function(){e.moveEvent&&e.downEvent&&e.largeMove||i.call(t,n)}),500)))},secondHandler:function(o){if(!xt(o)){if(clearTimeout(e.downTimeout),!i&&e.moveEvent&&e.downEvent&&e.largeMove)return e.downEvent=void 0,e.target=void 0,e.moveEvent=void 0,void(e.largeMove=!1);if(e.moveEvent=void 0,e.largeMove=!1,Lt(o)||!e.downEvent||!i&&o.target!==e.target)return e.downEvent=void 0,void(e.target=void 0);if(i&&(t.oncontextmenu=null),o.defaultPrevented&&(t.onclick=At,setTimeout((function(){t.onclick=null}),0)),o.preventHandling)return e.downEvent=void 0,void(e.target=void 0);var r=o.timeStamp-e.downEvent.timeStamp;r>=500&&i&&n.call(t,o),r<500&&!i&&n.call(t,o),e.downEvent=void 0,e.target=void 0}},thirdHandler:f.default(10,(function(t){var n,i,o,r;e.downEvent&&!xt(t)&&(e.moveEvent=t,e.largeMove=e.largeMove||(n=e.moveEvent,i=e.downEvent,o=Rt(n,i),r=Tt(n,i),Math.sqrt(o*o+r*r)>5))})),vars:e};return Mt.push(o),o}}function It(t,n){Object.assign(t,{distanceX:Rt(t,n),distanceY:Tt(t,n)})}var Ft,qt={addTapListener:function(t,n,i){var e=Ht(t,n,i);e&&(t.addEventListener(St,e.firstHandler),t.addEventListener(Ot,e.secondHandler),t.addEventListener(Pt,e.thirdHandler))},removeTapListener:function(t,n,i){var e=jt(t,n,i);e&&(Ut(e.vars),t.removeEventListener(St,e.firstHandler),t.removeEventListener(Ot,e.secondHandler),t.removeEventListener(Pt,e.thirdHandler),Mt.splice(Mt.indexOf(e),1))},addHoverListener:function(t,n,i){var e=function(t,n,i){if(!jt(t,n,i)){var e={element:t,type:1,primaryHandler:n,secondaryHandler:i,firstHandler:function(i){xt(i)||n.call(t,i)},secondHandler:function(n){xt(n)||i.call(t,n)}};return Mt.push(e),e}}(t,n,i);e&&(t.addEventListener(Ct,e.firstHandler),t.addEventListener(Et,e.secondHandler))},removeHoverListener:function(t,n,i){var e=jt(t,n,i);e&&(t.removeEventListener(Ct,e.firstHandler),t.removeEventListener(Et,e.secondHandler),Mt.splice(Mt.indexOf(e),1))},addMoveListener:function(t,n,i,e){var o=function(t,n,i,e){var o={downEvent:void 0,preventHandling:void 0};if(!jt(t,n,i,e)){var r={element:t,type:2,primaryHandler:n,secondaryHandler:i,tertiaryHandler:e,firstHandler:function(i){Lt(i)||xt(i)||(o.downEvent=i,o.preventHandling=!kt&&function(t,n){for(var i=t;i;){if("a"===i.tagName.toLowerCase())return!0;if(i===n)return!1;i=i.parentElement}return!1}(i.target,t)||void 0,n.call(t,i))},secondHandler:f.default(10,(function(n){if(!o.downEvent||xt(n))return!0;if(void 0===o.preventHandling){var e=Rt(o.downEvent,n),r=Tt(o.downEvent,n);o.preventHandling=Math.abs(e)<Math.abs(r)}if(o.preventHandling)return o.downEvent=void 0,!1;n.preventDefault(),It(n,o.downEvent),i.call(t,n)})),thirdHandler:function(n){xt(n)||(!Lt(n)&&o.downEvent?(It(n,o.downEvent),o.downEvent=void 0,e.call(t,n)):o.downEvent=void 0)},vars:o};return Mt.push(r),r}}(t,n,i,e);o&&(t.addEventListener(St,o.firstHandler),document.addEventListener(Pt,o.secondHandler,!1),document.addEventListener(Ot,o.thirdHandler))},removeMoveListener:function(t,n,i,e){var o=jt(t,n,i,e);o&&(Ut(o.vars),t.removeEventListener(St,o.firstHandler),document.removeEventListener(Pt,o.secondHandler,!1),document.removeEventListener(Ot,o.thirdHandler),Mt.splice(Mt.indexOf(o),1))},addListener:function(t,n,i){var e=function(t,n,i){if(!jt(t,i)){var e={element:t,type:3,eventName:n,primaryHandler:i,firstHandler:i,secondHandler:i};return Mt.push(e),e}}(t,n,i);e&&t.addEventListener(n,i)},removeListener:function(t,n,i){var e=jt(t,i);e&&(t.removeEventListener(e.eventName,e.firstHandler),Mt.splice(Mt.indexOf(e),1))},removeListeners:function(t){for(var n=Mt.length;n--;){var i=Mt[n];if(i.element===t){switch(i.type){case 0:Ut(i.vars),t.removeEventListener(St,i.firstHandler),t.removeEventListener(Ot,i.secondHandler),t.removeEventListener(Pt,i.thirdHandler);break;case 1:t.removeEventListener(Ct,i.firstHandler),t.removeEventListener(Et,i.secondHandler);break;case 2:Ut(i.vars),t.removeEventListener(St,i.firstHandler),document.removeEventListener(Pt,i.secondHandler),document.removeEventListener(Ot,i.thirdHandler);break;case 3:t.removeEventListener(i.eventName,i.firstHandler)}Mt.splice(n,1)}}},preventHandling:function(t){Object.assign(t,{preventHandling:!0})},getEventPoint:Nt,eventPreventDefault:At,POINTERDOWN:St,POINTERMOVE:Pt,POINTEROVER:"mouseover",HAS_TOUCHEVENTS:kt};function Vt(t,n){var i=t.currentTarget,e=n.onClick||n.onMouseEnter;e&&"function"==typeof e&&!1===e()||function(t){return t.html?Promise.resolve(t.html()):new Promise((function(n){l.default.ajax({url:t.url()}).then((function(t){n(t.response)}))}))}(n).then((function(t){it.getShortcutMenuAdapter().then((function(e){Ft=e.hide,e.show(i,t,n.params)}))}))}function Kt(t){Ft?Ft(t):it.getShortcutMenuAdapter().then((function(n){return n.hide(t)}))}var Dt={transform:function(t,n){t.style.webkitTransform=n,t.style.transform=n},transitionEnd:"webkitTransition"in document.documentElement.style?"webkitTransitionEnd":"transitionend"};function zt(t){et((function(){var n=t.target,i=n.files;if(i){var e=n.getAttribute("data-location")||"unknown",o=n.getAttribute("data-ownerId")||null;Qt.upload(Array.prototype.slice.call(i),null,e,o),n.value="",Gt.postingAddClick(e)}}),"modelUploadHandler")}function Bt(t){et((function(){if(!(t instanceof MouseEvent&&(t.ctrlKey||t.shiftKey||t.metaKey))){t.preventDefault();var n=t.currentTarget.getAttribute("data-details");n&&Jt.openLayer(p(p({},JSON.parse(n)),{origin:"UNKNOWN"}))}}),"modelHandleClick")}et((function(){!function(){var t="classList"in Element.prototype,n=document.createElement("_");if(t&&n.classList.add("c1","c2"),!t||!n.classList.contains("c2")){a.default.success("dailyphoto.polyfill","classListParams");var i=function(t){var n=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var i,e=arguments.length;for(i=0;i<e;i++)t=arguments[i],n.call(this,t)}};i("add"),i("remove")}if(t&&n.classList.toggle("c3",!1),!t||n.classList.contains("c3")){a.default.success("dailyphoto.polyfill","classListToggle");var e=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,n){return 1 in arguments&&!this.contains(t)==!n?n:e.call(this,t)}}}(),window.SVGElement&&window.SVGElement.prototype&&("classList"in window.SVGElement.prototype||(a.default.success("dailyphoto.polyfill","svgClassList"),function(){var t=function(t){return new RegExp("(^| )"+t+"( |$)")},n=function(t,n,i){for(var e=0;e<t.length;e++)n.call(i,t[e])};function i(t){this.element=t}i.prototype={add:function(){n(arguments,(function(t){this.contains(t)||(this.element.className+=" "+t)}),this)},remove:function(){n(arguments,(function(n){this.element.className=this.element.className.replace(t(n),"")}),this)},toggle:function(t){return this.contains(t)?(this.remove(t),!1):(this.add(t),!0)},contains:function(n){return t(n).test(this.element.className)},replace:function(t,n){this.remove(t),this.add(n)}},Object.defineProperty(SVGElement.prototype,"classList",{get:function(){return new i(this)}})}()));var t=String.prototype;"function"!=typeof t.startsWith&&(a.default.success("dailyphoto.polyfill","stringStartsWith"),t.startsWith=function(t,n){return this.indexOf(t,n=n||0)===n}),t.includes||(a.default.success("dailyphoto.polyfill","stringIncludes"),t.includes=function(t,n){return"number"!=typeof n&&(n=0),!(n+t.length>this.length)&&-1!==this.indexOf(t,n)}),function(){if("performance"in window==0&&(a.default.success("dailyphoto.polyfill","performance"),window.performance={}),"now"in window.performance==0){a.default.success("dailyphoto.polyfill","performanceNow");var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}}(),function(){for(var t=0,n=["webkit","moz"],i=0;i<n.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[n[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[i]+"CancelAnimationFrame"]||window[n[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(a.default.success("dailyphoto.polyfill","requestAnimationFrame"),window.requestAnimationFrame=function(n,i){var e=(new Date).getTime(),o=Math.max(0,16-(e-t)),r=window.setTimeout((function(){n(e+o)}),o);return t=e+o,r}),window.cancelAnimationFrame||(a.default.success("dailyphoto.polyfill","cancelAnimationFrame"),window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),Array.prototype.find||(a.default.success("dailyphoto.polyfill","arrayFind"),Array.prototype.find=function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n,i=Object(this),e=i.length>>>0,o=arguments[1],r=0;r<e;r++)if(n=i[r],t.call(o,n,r,i))return n}),Array.prototype.findIndex||(a.default.success("dailyphoto.polyfill","arrayFindIndex"),Array.prototype.findIndex=function(t){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n,i=Object(this),e=i.length>>>0,o=arguments[1],r=0;r<e;r++)if(n=i[r],t.call(o,n,r,i))return r;return-1}),function(){var t,n,i,e;if(Array.from||(a.default.success("dailyphoto.polyfill","arrayFrom"),Array.from=(t=Object.prototype.toString,n=function(n){return"function"==typeof n||"[object Function]"===t.call(n)},i=Math.pow(2,53)-1,e=function(t){var n=function(t){var n=Number(t);return isNaN(n)?0:0!==n&&isFinite(n)?(n>0?1:-1)*Math.floor(Math.abs(n)):n}(t);return Math.min(Math.max(n,0),i)},function(t){if(void 0===t.length&&"function"==typeof t.next){for(var i,o=[];(i=t.next())&&!i.done;)o.push(i.value);return o}var r=this,u=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var c,a=arguments.length>1?arguments[1]:void 0;if(void 0!==a){if(!n(a))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(c=arguments[2])}for(var s,f=e(u.length),h=n(r)?Object(new r(f)):new Array(f),l=0;l<f;)s=u[l],h[l]=a?void 0===c?a(s,l):a.call(c,s,l):s,l+=1;return h.length=f,h})),!Array.prototype.includes){a.default.success("dailyphoto.polyfill","arrayIncludes"),Object.defineProperty(Array.prototype,"includes",{value:function(t,n){if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),e=i.length>>>0;if(0===e)return!1;for(var o,r,u=0|n,c=Math.max(u>=0?u:e-Math.abs(u),0);c<e;){if((o=i[c])===(r=t)||"number"==typeof o&&"number"==typeof r&&isNaN(o)&&isNaN(r))return!0;c++}return!1}})}}(),Object.assign||(a.default.success("dailyphoto.polyfill","objectAssign"),Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t,n){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var i=Object(t),e=1;e<arguments.length;e++){var o=arguments[e];if(null!=o)for(var r=Object.keys(Object(o)),u=0,c=r.length;u<c;u++){var a=r[u],s=Object.getOwnPropertyDescriptor(o,a);void 0!==s&&s.enumerable&&(i[a]=o[a])}}return i}})),Object.values||(a.default.success("dailyphoto.polyfill","objectValues"),Object.defineProperty(Object,"values",{enumerable:!1,configurable:!0,writable:!0,value:function(t){return Object.keys(t).map((function(n){return t[n]}))}})),function(t){function n(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0}),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0})}function i(){Object.defineProperty(this,"signal",{value:new n,writable:!0,configurable:!0})}("function"==typeof t.Request&&!t.Request.prototype.hasOwnProperty("signal")||!t.AbortController)&&(a.default.success("dailyphoto.polyfill","abortController"),n.prototype={addEventListener:function(t,n){t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push(n)},dispatchEvent:function(t){if("abort"===t.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,t)),t.type in this.listeners){for(var n=this.listeners[t.type],i=0,e=n.length;i<e;i++)n[i](t);return!t.defaultPrevented}},removeEventListener:function(t,n){if(t in this.listeners)for(var i=this.listeners[t],e=0,o=i.length;e<o;e++)if(i[e]===n)return void i.splice(e,1)},toString:function(){return"[object AbortSignal]"}},i.prototype={abort:function(){var t;try{t=new Event("abort")}catch(n){(t=document.createEvent("Event")).initEvent("abort",!1,!1)}this.signal.dispatchEvent(t)},toString:function(){return"[object AbortController]"}},"undefined"!=typeof Symbol&&Symbol.toStringTag&&(i.prototype[Symbol.toStringTag]="AbortController",n.prototype[Symbol.toStringTag]="AbortSignal"),t.AbortController=i,t.AbortSignal=n)}(window),!window.URL||"function"==typeof window.URL.createObjectURL&&"function"==typeof window.URL.revokeObjectURL||(a.default.success("dailyphoto.polyfill","createObjectURL"),window.URL.createObjectURL=window.URL.createObjectURL||window.URL.webkitCreateObjectURL||window.URL.mozCreateObjectURL||window.URL.msCreateObjectURL,window.URL.revokeObjectURL=window.URL.revokeObjectURL||window.URL.webkitRevokeObjectURL||window.URL.mozRevokeObjectURL||window.URL.msRevokeObjectURL)}),"modelPolyfill");var Wt=_t,Jt=pt,Gt=O,Xt=new P,Qt=new Y,Yt=new q,$t=I,Zt=function(){return new $},tn=z,nn=it,en=function(t,n){function i(n){var i=n.target,e=document.getElementById(Wt.isMobile?"dailyphoto-menu":"hook_Block_ShortcutMenu");t.contains(i)||!e||e.contains(i)||Kt(!0)}function e(){document.documentElement.classList.contains("ie")?setTimeout(Kt,n.params.hideDelay):Kt()}function o(t){n.onHide&&n.onHide(t),qt.removeTapListener(document.body,i)}return(n.onClick||Wt.isMobile)&&(qt.addTapListener(t,(function(t){!function(t,n){qt.preventHandling(t),Vt(t,n)}(t,n),qt.addTapListener(document.body,i)})),Wt.isMobile||t.addEventListener(Et,e)),n.onMouseEnter&&!Wt.isMobile&&qt.addHoverListener(t,(function(t){!function(t,n){Vt(t,n)}(t,n)}),e),t.addEventListener("shortcut-menu-hide",o),function(){qt.removeListeners(t),qt.removeTapListener(document.body,i),t.removeEventListener(Et,e),t.removeEventListener("shortcut-menu-hide",o)}},on=qt,rn=Dt;function un(){return!!_t.layer}function cn(t){et((function(){if(_t.layer){var n=_t.layer.getRoot();_t.layer.destroy(t).then((function(){if(n&&_t.root&&_t.root.contains(n)&&_t.root.removeChild(n),_t.layer=null,!Wt.isMobile){var t=window.OK.Layers.getTopLayerId();t&&0===t.indexOf(wt)&&(window.OK.Layers.remove(t),window.OK.Layers.onLayerHidden(),_t.root.mode&&n&&s.default.deactivate(n))}}))}}),"modelCloseLayer")}return t.activate=function(t){et((function(){var n,i=t.getAttribute("data-details");if(i){var e=JSON.parse(i);switch(t.getAttribute("data-event")){case"open":Jt.openLayer(p(p({},e),{origin:"UNKNOWN"}));break;case"delete":Jt.deletePhoto(e.id);break;case"delete_author":var o=_t.users[Jt.getOwnerId(e.id)];o&&(o.isUnsubscribed=!0),cn();break;case"subscribe":var r=_t.users[Jt.getOwnerId(e.id)];r&&(r.isUnsubscribed=!1);break;case"moderate_challenge_decline":var u=_t.photos;for(var c in u){if(u.hasOwnProperty(c))(a=u[c])&&a.mediaKey===e.id&&(a.moderationKey="")}break;case"delete_from_challenge":u=_t.photos;for(var c in u){var a;if((null==(a=u[c])?void 0:a.commitId)===e.commitId){var s=null===(n=a.blocks)||void 0===n?void 0:n.findIndex((function(t){return 8===t.type}));-1!==s&&(a.blocks.splice(s,1),a.challengeModerated=!0,a.challengeDenied=!0)}cn()}break;default:t.addEventListener("click",Bt),t.addEventListener(on.POINTEROVER,Jt.preloadPhoto)}}}),"modelActivate")},t.activateUpload=function(t){et((function(){t.disabled=!1,t.addEventListener("change",zt)}),"modelActivateUpload")},t.closeLayer=cn,t.createShortcutMenu=en,t.css=rn,t.deactivate=function(t){et((function(){on.removeTapListener(t,Bt),t.removeEventListener("click",Bt),t.removeEventListener(on.POINTEROVER,Jt.preloadPhoto)}),"modelDeactivate")},t.deactivateUpload=function(t){et((function(){t.removeEventListener("change",zt)}),"modelDeactivateUpload")},t.deferredFactory=Zt,t.emojiService=$t,t.eventService=on,t.globalCtrl=Jt,t.globalStore=Wt,t.handleUrl=function(t,n){et((function(){var i=n&&-1!==n.indexOf("_")?n.slice(2):n;if(i="actual"===i||"new"===i?void 0:i,un())_t.layer.handleUrl({mediaId:i,authorId:t});else{var e=-1!==t.indexOf("_")?t:Jt.getOwnerId(t);Jt.openLayer({mediaId:i,ownerId:e===_t.ratingOwnerId?_t.ratingOwnerId:e,source:"url",origin:"UNKNOWN"})}}),"modelHandleUrl")},t.isLayerOpened=un,t.lazyModule=nn,t.loader=Xt,t.operationLogger=Gt,t.storage=Yt,t.togglePlayer=function(t){_t.isPlayerActive=t},t.uploader=Qt,t.webApiRequestFactory=tn,Object.defineProperty(t,"__esModule",{value:!0}),t}({},window.OK.dailyphoto.logger,window.OK.dailyphoto.logClicks,window.OK.dailyphoto.quasiState,window.OK.dailyphoto.throttle,window.OK.dailyphoto.pts,window.OK.dailyphoto.vanilla);
