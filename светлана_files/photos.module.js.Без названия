!function(T){var t,e,o,n,a,r,i,s,c,l,d,u,p,h,m,f,v,g,b,C,y,w,x,_,k,A,I,N,P,M,E,S,R,D,B,z,q,O,j,V,W,H,L,F,U,Q,X,Z,Y,K,G,J,$,tt,et,nt,ot,at,rt,it,st,ct,lt,dt,ut,pt,ht,mt,ft,vt,gt,bt,Ct,yt,wt,xt,_t,kt,At,It,Nt,Pt,Mt,Et,St,Tt,Rt,Dt,Bt,zt,qt,Ot,jt,Vt,Wt,Ht,Lt,Ft,Ut,Qt,Xt,Zt,Yt,Kt,Gt,Jt,$t,te,ee,ne,oe,ae,re,ie,se,ce,le,de,ue,pe,he,me,fe,ve,ge,be,Ce,ye,we,xe,_e,ke,Ae,Ie,Ne,Pe,Me,Ee,Se,Te,Re,De,Be,ze,qe,Oe,je,Ve,We,He,Le,Fe,Ue,Qe,Xe,Ze,Ye,Ke,Ge,Je,$e,tn,en,nn,on,an,rn,sn,cn,ln,dn,un,pn,hn,mn,fn,vn,gn,bn,Cn,yn,wn,xn,_n,kn,An,In,Nn,Pn,Mn,En,Sn,Tn,Rn,Dn,Bn,zn,qn,On,jn,Vn,Wn,Hn,Ln,Fn,Un,Qn,Xn,Zn,Yn,Kn,Gn,Jn,$n,to,eo,no,oo,ao,ro,io,so,co,lo,uo,po,ho,mo,fo,vo,go,bo,Co,yo,wo,xo,_o,ko,Ao,Io,No,Po,Mo,Eo,So,To,Ro,Do,Bo,zo,qo,Oo,jo,Vo,Wo,Ho,Lo,Fo,Uo,Qo,Xo,Zo,Yo,Ko,Go,Jo,$o,ta,ea,na,oa,aa,ra,ia,sa,ca,la,da,ua,pa,ha,ma,fa,va,ga,ba,Ca,ya,wa,xa,_a,ka,Aa,Ia,Na,Pa,Ma,Ea,Sa,Ta,Ra,Da,Ba,za,qa,Oa,ja,Va,Wa,Ha,La,Fa,Ua,Qa,Xa,Za,Ya,Ka,Ga,Ja,$a,tr,er,nr,or,ar,rr,ir,sr,cr,lr,dr,ur,pr,hr,mr,fr,vr,gr,br,Cr,yr,wr,xr,_r,kr,Ar,Ir,Nr,Pr,Mr,Er,Sr,Tr,Rr,Dr,Br,zr,qr,Or,jr,Vr,Wr,Hr,Lr,Fr,Ur,Qr,Xr,Zr,Yr,Kr,Gr,Jr,$r,ti,ei,ni,oi,ai,ri,ii,si,ci,li,di,ui,pi,hi,mi,fi,vi,gi,bi,Ci,yi,wi,xi,_i,ki,Ai,Ii,Ni,Pi,Mi,Ei,Si,Ti,Ri,Di,Bi,zi,qi,Oi,ji,Vi,Wi,Hi,Li,Fi,Ui,Qi,Xi,Zi,Yi,Ki,Gi,Ji,$i,ts,es,ns,os,as,rs,is,ss,cs,ls,ds,us,ps,hs={},ms=T.okModules||(T.okModules={}),fs=T.document,vs=fs.documentElement;function gs(){p={},A={},S=!(b=E=!(I={})),N={},B=0,z=!(P={}),k=w=R=M=null}function bs(s){m=s.viewerId,l(s.map,function(t,e){t.id=e,t.ownerId=t.ownerId||f,t.groupId=t.groupId||v;var n,o,a=t.can,r={};for(n in t.can=r,j)j.hasOwnProperty(n)&&(o=j[n],r[n]=(o&a)===o);if(t.photoWallContestId&&(p[t.id]&&1<=B)){delete s.map[t.id];var i=s.order.indexOf(parseInt(t.id));return void s.order.splice(i,1)}r.info=!r.notInfo,(p[e]=t).attachedToMsgId&&!N[e]&&(N[e]=t.attachedToMsgId),t.photoWallContestId&&!P[e]&&(P[e]={photoWallContestId:t.photoWallContestId,photoWallMarker:t.photoWallMarker,photoWallIndex:B,photoWallParticipating:z,photoWallFilterType:k})}),ys(s.order||[],!s.attachThroughScrollingEnabled)}function Cs(t,e){var n,o,a=c.start();return V[t]?a.reject():(n="on"===u.options.isCropMode||!0===u.options.isCropMode,o=function(t,e,n){if(e){var o=P[t];return o||(P[t]={photoWallContestId:e,photoWallMarker:n,photoWallIndex:B++,photoWallParticipating:z,photoWallFilterType:k})}}(t,x,_),i.getPhotos(f,v,g,t,!S,M,E,y,D,function(t,e){if(e){var n=N[t];return n||(N[t]=e)}}(t,e),o,R,n).then(function(t){bs(t),a.resolve(),h=null},function(){V[t]=!0,a.reject()})),a}function ys(t,e){for(var n=0,o=t.length;n<o;n++){var a=t[n],r=I[a],i=0==n?q:t[n-1],s=A[a],c=n==o-1?q:t[n+1],r=r===q?null:r,s=s===q?null:s;I[a]=r||i,A[a]=s||c}1===t.length&&e&&(I[a]=A[a]=O)}function ws(t,e){var n=c.start(),o=function(t,e,n){var o=t[n];e.resolve(o==q||o==O?null:o)}.bind(0,t,n,e);function a(){t[e]==q?(h=Cs(e,w)).then(o,n.reject.bind(n)):o()}return h?h.then(a,a):a(),n}function xs(t,e,n){for(var o in t){var a;!t.hasOwnProperty(o)||(a=t[o])==e&&(t[o]=a==n?null:n)}}function _s(t){var e=Date.now()-H.getTime()-t.time;L?U.push(t):0<e?t.fn():setTimeout(_s.bind(0,t),Math.abs(e))}function ks(){H=new Date}function As(t){$&&Q.switchClass($,t,"__shown")}function Is(){As(!1)}function Ns(){G.toIdle(function(){var t=Y.picture,e=t&&t.photo||tt;As(!Y.gifIsPlaying&&e&&e.gif)},4)}function Ps(t){X.touchStartPreview[t](Is),X.touchEndPreview[t](Ns)}function Ms(t,e){this.domRoot=e,this.data=t,this.dom=pt.byDataId(e)}function Es(t){var e=fs.querySelector(".quick-photo-comment_list-w");it.switchClass(e,t,"dsn")}function Ss(t){var e=this;return(e.onSync||(e.onSync=[])).push(t),e.done&&(xt.runCallback(e,t),t.call(e,e.result)),e}function Ts(t){It.setPhrases(t),Mt.phrases=t}function Rs(t){return"okMenu"+t}function Ds(t,e,n){var o,a,r=t[Rs(e)];(n=n||r)&&((o=St.getOrMakeBehavior(n))&&o.menuStateReset&&o.menuStateReset(),n===r&&delete t[e],(a=n.parentNode)&&a.removeChild(n))}function Bs(r){Lt.clear(r.pinsBox),Ft.setViewMode(Xt.getViewMode()),Xt.photo(r.photo.id).then(function(t){var e,n,o,a;if(t.pins){for(e=0,n=t.pins.length;e<n;e++)o=t.pins[e],a=Ft.createAcceptPinNew(o),r.pinsBox.appendChild(a.domRoot),r.size&&function(t,e,n,o){var a=t.size.zoom,r=Math.round(t.size.width),i=Math.round(t.size.height),s=Math.max(r/(2*-n.offsetX),i/(2*-n.offsetY)),c=Math.round(s*(o.x+n.offsetX)),l=Math.round(s*(o.y+n.offsetY)),d=Math.round(r/2)-20,u=Math.round(i/2)-20,p=Math.round(s*o.x);Math.abs(c)>d&&(c=c<0?-d:d);Math.abs(l)>u&&(l=l<0?-u:u);e.style.left=c+"px",e.style.top=l+"px",Math.round(s*o.y)+e.offsetHeight>i&&(Lt.addClass(e,"__bottom"),e.firstChild.style.top=-e.offsetHeight+"px");p=Math.max(Math.min(p,r-20),20);var h=Math.round(e.firstChild.offsetWidth/2),m=Math.round((Ht.layer.domRoot.clientWidth-t.box.offsetWidth*a)/2/a);m<p+h-r?e.firstChild.style.left=m-(p+h-r)+"px":m<h-p&&(e.firstChild.style.left=h-p-m+"px")}(r,a.domRoot,t,o);Lt.switchClass(r.pinsBox,!Ht.modPin,"hidden")}},function(){})}function zs(t,e){this.pin=t,this.element=e}function qs(e,n){Jt.config.attach(function(t){t&&"photos"==t.ns&&e(t)}),Jt.appendPipeline(function(t){var e=t&&t.photo;e&&n(e,t)})}function Os(){var t=this.contentWrapper.scrollHeight>this.contentWrapper.clientHeight;ue.switchClass(this.contentWrapper,t,"__has-scroll")}function js(){_e.innerHTML=Ie.descriptionHTML||"",Ls()}function Vs(){_e.textContent=Ie.description||"",Ls()}function Ws(t){Ie.description=t,Vs()}function Hs(){ve.switchClass(Pe,Ne,"__expanded"),ve.switchClass(ke,Ne,"__full"),ve.switchClass(_e,Ne,"wbr"),Ne&&ye.tapPreview.attachOnce(function(){Ne=!1,Me=(new Date).getTime()+400,Hs()})}function Ls(){ve.switchClass(Ae,Ee||!Ie.description,"__hidden"),ve.switchClass(Ae,!Ie.description,"__empty")}function Fs(){}function Us(t,e){this.dialog=e,this.textarea=e.querySelector("textarea")}function Qs(){return Ue.getElementsByClassName("photowall-progress_line")[0]}function Xs(t,e){this.dialog=e}function Zs(t){var e=t.errors,n=0<e.length?e[0]:"",o=Ke.phrases;n&&Xe.show(Ye.layer.domRoot,{view:"ErrDlg",behavior:Xs,title:n.replace(/\<br[^\>]*\>/gi,"\n").replace(/\<[^\>]*\>/gi,""),buttons:[{text:o?o.close:"→",func:"close"}]})}function Ys(t,e){this.dialog=e}function Ks(t,e){this.dialog=e}function Gs(t,e){this.dialog=e}function Js(t,e){this.dialog=e}function $s(t,e){this.dialog=e}function tc(t,e){this.dialog=e}function ec(t,e){this.dialog=e}function nc(){yo.change("/topphoto")}function oc(){for(var t=0,e=Io.length;t<e;t++){var n=Io[t];n.style.visibility="hidden",n.style.clip="rect(0,0,0,0)",fs.body.appendChild(n),No.push(n)}Io.length=0,Ao=null,setTimeout(ac,100)}function ac(){for(var t=0,e=No.length;t<e;t++)ko.remove(No[t]);No.length=0}function rc(t,e){}function ic(t){return Mo.hasClass(t,"widget_action")&&!Mo.hasClass(t,"__active")}function sc(){Oo.clear(Zo),Oo.clear(Yo);var t=Ko.groupId?"group":"user";Ko.can.openTopic&&(Ko.topicLink=cc(Go.topic[t],Ko)),Ko.can.describe&&Go.edit&&(Ko.editLink=cc(Go.edit[Ko.groupId?"group":Ko.albumId?"album":"user"],Ko)),Ko.widgetsPanelHtml&&Zo.insertAdjacentHTML("afterbegin",Ko.widgetsPanelHtml);var e=jo.createTopActions(Ko);Yo.appendChild(e.domRoot),e.linkViewPins&&Fo.modPin&&Oo.addClass(e.linkViewPins,"__mod")}function cc(t,e){var n=-1!=t.indexOf("apphook");return t.replace(/\$\{userId\}/gi,n?e.appOwnerId:e.ownerId).replace(/\$\{photoId\}/gi,n?e.appId:e.id).replace(/\$\{albumId\}/gi,n?e.appAlbumId:e.albumId).replace(/\$\{groupId\}/gi,n?e.appGroupId:e.groupId).replace(/&[^=]+=(null|undefined)/gi,"").replace(/\$\{returnUrl\}/gi,encodeURIComponent(Uo.relative(T.location.href)))}function lc(t){var e,n;Ko=t,Go?sc():(e=Wo.get(),n=Ho.get(),e.synced(function(o){n.then(function(t){Go=o;var e=t.nav,n=t.aria;e&&n&&(Vo.label(Xo.linkMenu,n.menu,!0),Vo.label(Xo.linkClose,t.close,!0)),sc()})}))}function dc(){ea.get().then(function(){var t;ta.clear(ra),ia.photocontestPanelHtml?ra.insertAdjacentHTML("afterbegin",ia.photocontestPanelHtml):ia.votes&&(t=na.createVote(ia),ra.appendChild(t.domRoot))})}function uc(){}function pc(t,e,n){var o;"transform"===e.name&&(o=t,n.style[ua]="translate3d("+o.translateX+"px, "+o.translateY+"px, 0) rotate("+o.rotate+"deg) scale("+o.scale+")")}function hc(t){return Math.sqrt(t)}function mc(t){return Math.abs(Math.sin(Math.PI*t))}function fc(t,e){this.modalRoot=e}function vc(t,r,i){var e=ga.getPhotoWallContestId(Ca.photo).photoWallContestId,s=va.parentBySelector(t.target,Ra),c=va.parentBySelector(t.target,".contest-panel"),l=fa.hasClass(s,"__active");Ca.layer.progress(ya.voteInPhotoWall(Ea.id,e,r,l).then(function(t){if(t.success){if(t&&t.payUrl)return void _a.change(t.payUrl);var e,n,o,a;s.getElementsByClassName("ic-img")[0].src=t.activeImageScr,fa.switchClass(s,!l,"__active"),r?(a=(e=s.nextSibling?s.nextSibling:s.previousSibling.getElementsByClassName("js-vote_count")[0]).textContent?parseInt(e.textContent):0,n=parseInt(s.getAttribute("data-coefficient")),e.textContent=a+n):(a=(o=s.getElementsByClassName("js-vote_count")[0]).textContent?parseInt(o.textContent):0,o.textContent=a+(l?-1:1)),Ea.widgetsPanelHtml=c.outerHTML,wa.onPhotoUpdate(),ga.replace(Ea,Ea),i&&"function"==typeof i&&!l&&i.call(this)}}))}function gc(){}function bc(t){La=t,za.get().then(function(){var t;Ba.clear(Ha),La.autoPinsConfirmLabel?(t=qa.createAutoPinsPanel(La),Ha.appendChild(t.domRoot),ja.modPin&&Ba.removeClass(Ha.parentNode,"hidden")):Ba.addClass(Ha.parentNode,"hidden")})}function Cc(t){this.domBox=t}function yc(t){var e,n,o,a,r=Za.controls&&Za.controls.view;function i(){var t;Za.photo===e&&(Za.hash=a,r.setBusy("true"),(t=Ya.options).openPhotoSoon&&($a.swapOnGo(),t.openPhotoSoon=!1,t.landedUrl=T.location.href),$a.goOrSwapIfSamePage({photo:e,pageName:"photo",url:a}),r.setBusy("false"))}r&&(e=this.photo,Ka.stores(e)||(Ga.copy(t,e),Ka.replace(t,e)),e.can.info||(n=Za.controls&&Za.controls.view)&&(n.dom.linkMenu.style.display="none"),Za.photo=e,o=Ja.getState(),a=function(t){if(t.msgId||Ka.getChatMessageId())return"";var e=Ka.getPhotoWallContestId(t);if(e)return"/topphoto/photo/"+parseInt(t.id).toString(16)+"_"+e.photoWallContestId;if("USER_SHARED"===t.ownerType)return"/profile/"+t.ownerId+"/shared/"+t.albumId+"/"+t.id;var n=t.groupId,o=t.albumId,a=n?["","group",n]:["","profile",t.ownerId];return o||n?a.push("album",o||"",t.id):a.push("pphoto",t.id),a.join("/")}(e),(o&&o.photo?o.photo.id:null)!=e.id||Ya.options.openPhotoSoon?1===Za.activatedPicturesCount?i():Qa.toIdle(i,gr.desktop?50:400):$a.render(),Fa.switchClass(r.dom.footer,Za.modPin&&Za.photo.pins,"hidden"))}function wc(t,e){this.view=new Cc(e),this.menuState={}}function xc(t){return{tap:function(){t.go(Za.photo)}}}function _c(){var t,e,n=Ya.options,o=n&&n.returnUrl;o?br.change(o):(t=Za.refreshOnClose,Za.layer?(e=Za.layer)&&e.close():400<Date.now()-kr&&vr(fs.querySelectorAll(".np_photoBox"),function(t){Fa.remove(t);var e=Za&&Za.photo?photo.id:-1;Za&&Za.photo&&photo.ownerId;wr.logPhotoView(T.pageCtx.stateId,Za.logCmd,e,!0)}),t&&setTimeout(function(){br.reload()},4))}function kc(t,e,n){t&&(n?(t.resetNavigationPath("next"),t.resetNavigationPath("previous")):t.accountAdjacent(e))}function Ac(n,o){return{touchStart:function(t){var e;"pointerdown"!==t.type&&"mousedown"!==t.type||2!==t.button||((e=t.target.style).pointerEvents="none",Wr(fs,"contextmenu",function(){setTimeout(function(){e.pointerEvents=""},0)}))},tap:function(){var t=Tr.picture,e=Tr[n];e&&(t.fold(o),e.unfold().activate())},wheel:function(t){var e=Tr.layer;e&&e.getBehavior().handleWheel(t)}}}function Ic(){}function Nc(t){var e=t.getAttribute("data-photo")||'{"absent":true}';return JSON.parse(e)}function Pc(t){var e,n,o,a,r,i,s,c,l,d,u,p,h,m,f,v,g,b,C,y,w,x,_,k,A,I,N,P,M=t.okPhotoShortlink;return M?(e=M.albumId,n=M.ownerId,o=M.groupId,r=M.id,c=M.contestId,i=T.pageCtx.stateId,d=1===(l=fs.querySelectorAll(".js-single-photo img[data-photo]")).length?(s=Mc((l=l[0]).src),Nc(l)):(s=Mc(),Nc(t)),c&&Fr.setPhotoWallData(c,null,!1,null)):(u=t.href||t.parentNode.href,h=(p=Ur.params(u))["st.soid"],f=h,v=(m=p)["st.mode"],g=m["st.phlst"],b=m["st.cmd"],C="altGroupPhotoInList"==b||"userPhotoInList"==b,y="off"!=m["st.nav"],w="on"==m["st.igps"],x=m["st.cpId"],_=m["st.cnm"],k="on"==m["st.pwp"],A=m["st.pft"],I=m._aid,Fr.setViewMode(v),Fr.setPhotoStreamUserId(f),Fr.setIsGroupPhotoStream(w),Fr.order(g&&g.split(";"),C),Fr.setNextPreviousEnabled(y),Fr.setLogActivityId(I),Fr.setPhotoWallData(x,_,k,A),Fr.setChatMessageId(null),e=p["st.albId"],n=p["st.friendId"],o=p["st.groupId"],a=p["st.msgid"],r=p["st.phoId"],i=p["st.cmd"],s=function(t){var e=t.style.backgroundImage||"url()";{(e=e.match(/url\(\'?\"?([^\'\"\)]*)/)[1])||t.firstChild&&(e="")}return Mc(e)}(t),d=Nc(t)),{albumId:e,ownerId:n,groupId:o,msgId:a,contestId:c,id:r,logCmd:i,photoStreamUserId:h,thumbnail:P=d,previewUrl:N=s,fullImageUrl:P.url||N}}function Mc(t){return t||"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAEALAAAAAABAAEAAAIBTAA7"}function Ec(t){var e,n=Qr.calc();try{e=t.getBoundingClientRect()||Zr}catch(t){e=Zr}return 0<=e.top&&0<=e.left&&e.bottom<=n.height&&e.right<=n.width}function Sc(t){t.zoom()}function Tc(){Ci=Kr.calc(),Jr.viewport=Ci}function Rc(t){t&&t.markActive(!1).zoom()}function Dc(t){var e=Jr.picture;e&&(Jr.viewport=t,e.zoom(),Rc(Jr.previous),Rc(Jr.next))}function Bc(t,e,n){var o,a,r,i;yi||!n&&Bi&&Bi.href===t.href||(Jr.activatedPicturesCount=0,$r.init.trigger(),mi.listenToIdle(),Bi=t,xi=si.parse(t),-1!=(o=t).href.indexOf("st.msgid")&&ni.extract(o),-1!=o.href.indexOf("adHocPhotoLayer")&&oi.extract(o),_i=xi.thumbnail,Ri=!e,Ni=n||ti.create(),a=t,r=e,i=Ni,ei.cleanRejected(),Ti=ei.context(xi).photo(xi.id),ci.get(),li.get(),_i.absent?(yi=!0,Ti.then(function(t){yi=!1,xi.thumbnail=t,xi.fullImageUrl=t.url,Bc(a,r,i)},function(){yi=!1}),mi.busy(),mi.toIdle(function(){Ni.progress(Ti)},400)):(function(){Tc(),Ni.position(Ci),Tc(),zc(Bi),Pi=Ni.domRoot,Mi=ai.create(xi).markActive(!0),Ei=xi.previewUrl;var t=xi.fullImageUrl;Si=Mi.load(t),Jr.viewport=Ci,mi.busy(),mi.toIdle(function(){Bi=null,Si&&Ni.progress(Si),Oc(),Lc()},400),(zi=!Ri&&!Oi)||qc(!1);fs.body.appendChild(Pi),Si.then(Wc,Fc),setTimeout(jc,200),Di=Date.now()}(),Jr.transitions=Wi,$r.pictureSelected.attach(Tc),Kr.changed.attach(Dc)))}function zc(t){var e;try{e=t.getBoundingClientRect()}catch(t){e={top:0,left:0}}Ai=t.clientWidth||100,Ii=t.clientHeight||100,ki={x:e.left+t.clientLeft,y:e.top+t.clientTop}}function qc(t){Gr.switchClass(Pi,!t,"__noAnim"),zi=t}function Oc(){Jr.controls||(ri.create(Ni.domRoot),ii.create(Ni.domRoot))}function jc(){fi.request(function(){Gr.addClass(Pi,"__shown")})}function Vc(){Si=null,ui.unlock()}function Wc(){var t,e,n,o;Uc(this)&&(setTimeout(jc,25),300<Date.now()-Di?qc(!1):(e=(t=Mi).size,n=e.width,o=e.height,Math.abs(n/o-Ai/Ii)<ji?t.move(ki.x+Math.max(0,(Ai-Ii*n/o)/2),ki.y+Math.max(0,(Ii-Ai*o/n)/2),Math.min(Ai/n,Ii/o)):t.move(ki.x+Ai/2,ki.y+Ii/2,Vi)),Ni.addPic(Mi),zi?(bi(vs,gi,Hc),Yr.start(Mi,Sc)):Sc(Mi),wi=xi.logCmd,Jr.logCmd=wi,mi.busy(),zi||Hc())}function Hc(){Oc(),Mi.activate(),$r.log("launch",T.pageCtx.stateId,wi),pi.rendering.attachOnce(Vc),Si&&ui.lock(),Ti.then(Lc),zi||Oi||setTimeout(function(){qc(!0)},400)}function Lc(){Yr.start(Pi,{__shownInfo:!0,__cropMode:$r.options.isCropMode})}function Fc(){Uc(this)&&(Si=Mi.load(Ei).then(Wc),Ti&&Ti.then(null,function(){vi.show(),setTimeout(Qc,2500)}))}function Uc(t){return Si===t}function Qc(){Si=null,$r.close.trigger();var t,e,n,o,a,r,i,s,c,l,d,u=Mi.size;Jr.picture&&u&&!Oi&&(t=Jr.photo,(o=(n=(e=1<Jr.activatedPicturesCount)&&t&&$r.findLinksToPhoto(t))&&hi.firstInViewport(n))&&zc(o),a=Vi,d=e&&!o?(r=Ci.width/2-5,Ci.height/2-5):(i=u.height,s=u.width,c=Ii/i,l=Ai/s,Math.abs(c-l)<ji?(a=Math.min(c,l),r=ki.x+(c<l?(Ai-s*a)/2:0),ki.y+(l<c?(Ii-i*a)/2:0)):(r=ki.x+Ai/2,ki.y+Ii/2)),Jr.picture.move(r,d,a)),pi.rendering.detach(Vc),setTimeout(function(){fi.request(function(){ui.unlock()})},Oi?0:200),Yr.startRemoval(Pi,Yr.css.hidden,Oi?50:200),Kr.changed.detach(Dc)}function Xc(t,e){var n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=n.top-o.top,r=n.left-o.left;return{top:a,left:r,right:r+n.width,bottom:a+n.height}}function Zc(t,e){this.root=e,this.input1X=fs.getElementById("fr_point1X"),this.input1Y=fs.getElementById("fr_point1Y"),this.input2X=fs.getElementById("fr_point2X"),this.input2Y=fs.getElementById("fr_point2Y");var n=Ki.byDataId(e),o=n.image,a=o.style,r=n.imageHover,i=r.style,s=n.crop,c={width:e.offsetWidth,height:e.offsetHeight},l=ts.createSize(o,c);a.width=l.width.toFixed()+"px",a.height=l.height.toFixed()+"px";var d=Xc(s,this.root);this.panAndZoom=Ji.create();var u=T.getComputedStyle(s).borderWidth,p=parseInt(u.substring(0,u.indexOf("px")));i.width=a.width,i.height=a.height,i.top=-d.top-p+"px",i.left=-d.left-p+"px";var h={onTransitioStyleChage:function(t){ns.setStyle(r,t)},onMoveAndScale:function(t){es.moveAndScale(r,t.translateX,t.translateY,t.zoom)}};this.foldAnimation=$i.createFoldAnimation(o,l,c,d,h),this.panAndZoom.reset({x:0,y:0},{x:0,y:0});var m=this.panAndZoom.peek();this.foldAnimation.to(-l.x,l.y,m),Yi.removeClass(o,"hidden"),Yi.removeClass(r,"hidden"),this.viewport=c,this.size=l,this.dom=n,this.cropRect=d;var f=this;os.request(function(){f.updateInputs()})}function Yc(t){var e=fs.querySelector(".layer-stub");e&&setTimeout(function(){ls.remove(e)},t)}function Kc(t){var e=t.clickSrc;as.openedFromAlbum=e.href&&-1!=e.href.indexOf("st.albId"),as.options=ds.photoOptions,as.urlAtLaunch=t.urlAtLaunch||T.location.href,as.options.isCropMode=e.href&&-1!=e.href.indexOf("st.crop=on"),rs.launch(e,!1!==t.effects),Yc(2e3)}function Gc(t){var e,n,o,a,r,i=(t||"").split("/"),s=i.length,c=ds.photoOptions||ps;if(3<=s){if("topphoto"===i[1]&&("photo"===i[2]||"photo"===i[3])){var l,d=i[i.length-1].split("_"),u=parseInt(d[0],16),p=d[1];null==p||-1!=(l=p.indexOf(";"))&&(p=p.substring(0,l));var h=fs.createElement("a");return h.okPhotoShortlink={id:u,albumId:null,ownerId:null,groupId:null,contestId:p},Kc({clickSrc:h,effects:!1}),!0}isNaN(parseInt(i[2]))&&(n=(e=c.openPhotoSoon||ps).profile,o=e.group,n?i.splice(1,1,"profile",n):o&&i.splice(1,1,"group",o),s=i.length,(r=(a=us.params(t))["st.closeUrl"])&&(c.returnUrl=r),c.isCropMode="on"==a["st.crop"],c.profileLinkWithOfferBattleDialog=a["st.profLinkDialog"]);var m="profile"===i[1];if(5<=s){var u=parseInt(i[s-1],10),f=i[3],v=i[4],g=m&&("pphoto"===f||"pphotos"===f),b="group"===i[1],C=-1!=t.indexOf("msg"),y=b||C?null:parseInt(i[2]),w=b?parseInt(i[2]):null,x=g||b&&""===v?null:parseInt(v),_=("album"===f||"shared"===f)&&!isNaN(x);if(!isNaN(u)&&0<u&&(g||m&&_||b&&_&&!isNaN(w)&&0<=w)){if(u&&(y||w)){var k=fs.createElement("a");return k.okPhotoShortlink={id:u,albumId:x,ownerId:y,groupId:w,contestId:null},Kc({clickSrc:k,effects:!1,urlAtLaunch:null}),!0}Yc(4)}}}return!1}function Jc(){var t=ss.getState();Gc(t?t.url:T.location.pathname)}hs.a=ms.suN7Qvg,hs.d=ms.gh4Wvfw,hs.e=ms.ffi0zg,hs.f=ms.fR7JqXA,hs.g=ms.uih3DA,hs.i=ms.taWQcQ,hs.j=ms.anMiJqQ,hs.n=ms.drmw1pw,hs.o=ms.dkYTtkQ,hs.p=ms.enDyBg,hs.r=ms.inIv7XA,hs.v=ms.oLP05wA,hs.ae=ms.eZbnNRg,hs.af=ms.p5v5Bpg,hs.ah=ms.bNXpVIA,hs.ai=ms.dAScy1A,hs.aj=ms.tFQn7A,hs.al=ms.aSQOUbQ,hs.ap=ms.tTkx9Vg,hs.ar=ms.tHdjjgg,hs.as=ms.pDEtI1A,hs.at=ms.soifKuQ,hs.bb=ms.t06j1LA,hs.bd=ms.vz5ZtYw,hs.be=ms.lK2Wdw,hs.bf=ms.aCr3dbg,hs.bk=ms.rkxiB0A,hs.bm=ms.aGvMJ9g,hs.bx=ms.mNKAJAg,hs.cf=ms.tjvWMA,hs.cg=ms.pjLo1bQ,hs.cl=ms.Axua2g,hs.cs=ms.aTRbAsg,hs.ct=ms.aHEJ56w,hs.cu=ms.lo4ogMg,hs.cy=ms.pSyOnNA,hs.dh=ms.aD4uIVg,hs.ea=ms.g52S7QA,hs.ee=ms.lj3hoIA,hs.eo=ms.nzpbqQg,hs.er=ms.ns1fqw,hs.es=ms.aClBajg,hs.fa=ms.pJWDPJw,hs.fd=ms.aZrBKQ,hs.fz=ms.aMJmAGg,hs.jo=ms.awkaNUg,hs.jv=ms.dlOcQwQ,hs.lp=ms.iwVqFzw,hs.rp=ms.cKYfWEw,hs.rq=ms.iUkPyTw||(ms.iUkPyTw={init:(t=hs.p).create(),close:t.create(),options:{},pictureSelected:t.create(),adjacentPhotoRequested:t.create(),pinProcessed:t.create()}),hs.rr=ms.sYncCOw||(ms.sYncCOw={clean:(e={clean:function(){for(var t in this)e.hasOwnProperty(t)||(this[t]=null)}}).clean}),hs.rs=ms.tUJZgEw||(ms.tUJZgEw=function(C){var f,h,y=fs,t={},w="photos";function e(){var t={ns:w},e=y.createElement("i");return e.okView="loadingTick",t.domRoot=e,t}function n(t,e,n){for(var o=y.createDocumentFragment(),a=0,r=e.length;a<r;a++)o.appendChild(t(e[a],a).domRoot);n.appendChild(o)}t.createLayer=function(){var t={ns:w},e=y.createElement("div");e.className="np_photoBox adaptable",e.setAttribute("data-func","root");var n=y.createElement("div");n.className="np_photoBox_back",t.fill=n;var o=y.createTextNode(" ");n.appendChild(o),e.appendChild(n);var a=y.createElement("div");return a.className="np_gif gif",t.gifBtn=a,e.appendChild(a),e.okView="layer",t.domRoot=e,t},t.createPicture=function(){var t={ns:w},e=y.createElement("div");e.className="np_img_cnt __offset",e.setAttribute("style","visibility: hidden");var n=y.createElement("img");n.className="np_img",t.img=n,e.appendChild(n);var o=y.createElement("div");return(t.pinsBox=o).className="pin",e.appendChild(o),e.okView="picture",t.domRoot=e,t},t.createLoading=function(t,e){var n={ns:w},o=y.createElement("div");return o.className="np_loading",a(t.ticks,o),o.okData={loading:t},o.okView="loading",n.domRoot=o,n},t.createLoadingTick=e;var a=n.bind(null,e);function o(t,e){var n={ns:w},o=y.createElement("a");return o.setAttribute("role","button"),o.className="np_mark np_mark"+t,o.setAttribute("data-func","mark"),o.setAttribute("data-mark",t),o.okData={mark:t},o.okView="mark",n.domRoot=o,n}t.appendLoadingTicksTo=a,t.createNavigationButtons=function(){var t={ns:w},e=y.createElement("div"),n=y.createElement("a");n.setAttribute("role","button"),n.className="np_near np_next",n.setAttribute("data-func","next"),t.toNext=n,e.appendChild(n);var o=y.createElement("span");o.className="np_near np_next np_near-ic",e.appendChild(o);var a=y.createElement("a");a.setAttribute("role","button"),a.className="np_near np_previous",a.setAttribute("data-func","previous"),t.toPrevious=a,e.appendChild(a);var r=y.createElement("span");return r.className="np_near np_previous np_near-ic",e.appendChild(r),e.okView="navigationButtons",t.domRoot=e,t},t.createControls=function(t,e){var n={ns:w},o=y.createElement("div");o.className="np_ctrls",o.setAttribute("aria-live","assertive"),o.setAttribute("aria-relevant","all"),o.setAttribute("aria-atomic","true");var a=y.createElement("div");a.className="np_ctrls-top",n.header=a;var r=y.createElement("div");r.className="np_ctrls-top_icons";var i=y.createElement("div");i.className="np_ctrls-top-actions",n.boxTopActions=i,r.appendChild(i);var s=y.createElement("a");s.setAttribute("role","button"),s.className="np_ctrls-top-icon layer-menu",s.setAttribute("data-func","menu"),n.linkMenu=s,r.appendChild(s);var c=y.createElement("a");c.setAttribute("role","button"),c.className="np_ctrls-top-icon layer-close",c.setAttribute("data-func","close"),n.linkClose=c,r.appendChild(c),a.appendChild(r),o.appendChild(a);var l=y.createElement("div");l.className="np_ctrls-bottom",n.footer=l;var d=y.createElement("div");d.className="np_marks-panel",n.marksPanel=d,l.appendChild(d);var u=y.createElement("div");u.className="np_bottom_upper",n.boxUpper=u,l.appendChild(u);var p=y.createElement("div");p.className="np_vote_w "+(C.photoOptions.quickPhotoCommentsEnabled?"__compact":""),n.boxVote=p,l.appendChild(p);var h=y.createElement("div");h.className="np_topic-actions_w",n.boxTopicActions=h,l.appendChild(h),o.appendChild(l);var m=y.createElement("div");m.className="np_ctrls-quick-comments",n.quickComments=m,o.appendChild(m);var f=y.createElement("div");f.className="np_ctrls-bottom hidden",n.pinsFooter=f;var v=y.createElement("div");v.className="np_pins-panel",n.pinsFooterPanel=v,f.appendChild(v),o.appendChild(f);var g=y.createElement("div");g.className="np_ctrls-overlay hidden",n.overlay=g;var b=y.createElement("canvas");return b.className="np_ctrls-canvas",n.overlayCanvas=b,g.appendChild(b),o.appendChild(g),o.okData={controls:t},o.okView="controls",n.domRoot=o,n},t.createCropMask=function(){var t={ns:w},e=y.createElement("div");e.className="np_cropMask";var n=y.createElement("div");return n.className="crop-mask",e.appendChild(n),e.okView="cropMask",t.domRoot=e,t},t.createTopActions=function(t,e){var n,o,a,r,i,s={ns:w},c=y.createElement("div");return c.className="np_ctrls-top-action_w",t.can.openTopic&&((n=y.createElement("a")).setAttribute("role","button"),n.className="np_ctrls-top-action ai alnk",n.href=t.topicLink,n.setAttribute("data-view-level","doc"),o=y.createTextNode(f.openTopicShort[t.groupId?"group":"user"]),n.appendChild(o),c.appendChild(n)),t.can.viewPins&&((a=y.createElement("a")).setAttribute("role","button"),a.className="np_ctrls-top-icon layer-pins "+(t.autoPinsConfirmLabel?"__scale":""),a.setAttribute("data-func","viewPins"),s.linkViewPins=a,(r=y.createElement("span")).className="np_ctrls-top-icon_tx",i=y.createTextNode(t.pins.length),r.appendChild(i),a.appendChild(r),c.appendChild(a)),c.okData={topActions:t},c.okView="topActions",s.domRoot=c,s},t.createDescription=function(){var t={ns:w},e=y.createElement("div");e.className="photo-description-w",e.setAttribute("data-func","toggle");var n=y.createElement("div");return n.className="photo-description",t.textBox=n,e.appendChild(n),e.okView="description",t.domRoot=e,t},t.createAttachSequence=function(){var t={ns:w},e=y.createElement("div");e.className="attach-sequence-w "+(C.photoOptions.attachmentSequenceCounterEnabled?"":"dsn"),e.setAttribute("data-func","toggle");var n=y.createElement("div");return n.className="attach-sequence",t.indexBox=n,e.appendChild(n),e.okView="attachSequence",t.domRoot=e,t},t.createPhotoWallProgress=function(){var t={ns:w},e=y.createElement("div");return e.className="photowall-progress-w dsn",e.setAttribute("data-func","toggle"),e.okView="photoWallProgress",t.domRoot=e,t},t.createMarks=function(t,e){var n,o,a,r,i,s,c,l,d,u,p,h={ns:w},m=y.createElement("div");return m.className="np_marks "+(C.photoOptions.quickPhotoCommentsEnabled?"__collapsed":""),C.photoOptions.quickPhotoCommentsEnabled&&((n=y.createElement("div")).className="np_marks_current-mark",o=y.createTextNode(f.marks?f.marks.current:""),n.appendChild(o),m.appendChild(n),v(t.marks,m),a=y.createElement("a"),(h.btnOpenMarks=a).setAttribute("role","button"),a.className="np_mark-open",a.setAttribute("data-func","open"),m.appendChild(a),(r=y.createElement("a")).setAttribute("role","button"),r.className="np_marks_raise-mark",(h.raiseMark=r).setAttribute("data-func","raiseMark"),r.setAttribute("data-raise-mark",t.fivePlus),i=y.createTextNode(f.marks?f.marks.raise:""),r.appendChild(i),m.appendChild(r),s=y.createElement("a"),(h.btnCloseMarks=s).setAttribute("role","button"),s.className="np_mark-close",s.setAttribute("data-func","close"),m.appendChild(s)),C.photoOptions.quickPhotoCommentsEnabled||((c=y.createElement("div")).className="np_marks",(l=y.createElement("div")).className="np_marks_current-mark",d=y.createTextNode(f.marks?f.marks.current:""),l.appendChild(d),c.appendChild(l),v(t.marks,c),(u=y.createElement("a")).setAttribute("role","button"),u.className="np_marks_raise-mark",(h.raiseMark=u).setAttribute("data-func","raiseMark"),u.setAttribute("data-raise-mark",t.fivePlus),p=y.createTextNode(f.marks?f.marks.raise:""),u.appendChild(p),c.appendChild(u),m.appendChild(c)),m.okData={marks:t},m.okView="marks",h.domRoot=m,h},t.createMark=o;var v=n.bind(null,o);function r(t,e){var n={ns:w},o=y.createElement("span");o.className="avatars-inline_cnt u-ava";var a=y.createElement("img");return a.src=t,a.className="avatars-inline_img u-ava_img",o.appendChild(a),o.okData={miniAvatar:t},o.okView="miniAvatar",n.domRoot=o,n}t.appendMarksTo=v,t.createVote=function(t,e){var n,o,a,r,i,s,c={ns:w},l=y.createElement("div");return l.className="np_vote topic-actions",t.can.vote&&((n=y.createElement("a")).setAttribute("role","button"),n.className="ai alnk np_vote_link",n.setAttribute("data-func","vote"),n.href="",(o=y.createElement("span")).className="ic ic-tick __mod",(a=y.createElement("span")).className="ic_tx np_vote_link_tx",r=y.createTextNode(f.vote),a.appendChild(r),o.appendChild(a),n.appendChild(o),l.appendChild(n)),t.can.vote||((i=y.createElement("span")).className="votes",s=y.createTextNode(t.votes),i.appendChild(s),l.appendChild(i)),l.okData={vote:t},l.okView="vote",c.domRoot=l,c},t.createAcceptPinNew=function(t,e){var n,o,a,r,i,s,c,l,d,u={ns:w},p=y.createElement("div");return p.className="pin-form-w __tag-user "+(t.canAccept&&"PIN_MARK"==h?"__mod":""),p.setAttribute("data-view","acceptPinNew"),p.setAttribute("data-func","touchPin"),t.canAccept&&((n=y.createElement("div")).className="pin-form __suggest "+("PIN_MARK"==h?"__mod":""),n.setAttribute("data-func","pinMenu"),(o=y.createElement("div")).className="pin-form_cnt",(a=y.createElement("div")).className="linecd",r=y.createTextNode(t.label),a.appendChild(r),o.appendChild(a),n.appendChild(o),p.appendChild(n)),t.canAccept||((i=y.createElement("div")).className="pin-form",t.canDecline&&((s=y.createElement("a")).href="#",s.className="pin-tag __tag-del",s.setAttribute("data-func","deletePin"),i.appendChild(s)),(c=y.createElement("div")).className="pin-form_cnt",(l=y.createElement("div")).className="linecd",d=y.createTextNode(t.label),l.appendChild(d),c.appendChild(l),i.appendChild(c),p.appendChild(i)),p.okData={acceptPinNew:t},p.okView="acceptPinNew",u.domRoot=p,u},t.createAutoPinsPanel=function(t,e){var n,o,a,r,i,s,c={ns:w},l=y.createElement("div");return t.autoPinsConfirmPreviews&&((n=y.createElement("div")).className="np_pins-panel_info",(o=y.createElement("div")).className="np_pins-panel_info_avatars avatars-inline __mini",d(t.autoPinsConfirmPreviews,o),n.appendChild(o),(a=y.createElement("div")).className="np_pins-panel_info_label",r=y.createTextNode(t.autoPinsConfirmLabel),a.appendChild(r),n.appendChild(a),l.appendChild(n),(i=y.createElement("a")).className="np_pins-panel_action",i.setAttribute("data-func","acceptAllAutoPins"),s=y.createTextNode(f.processAutoPins.confirmAll),i.appendChild(s),l.appendChild(i)),l.okData={autoPinsPanel:t},l.okView="autoPinsPanel",c.domRoot=l,c},t.createMiniAvatar=r;var d=n.bind(null,r);return t.appendMiniAvatarsTo=d,t.setPhrases=function(t){f=t},t.setViewMode=function(t){h=t},t}(hs.d)||T),hs.rt=ms.ps0V6FQ||(ms.ps0V6FQ=(o=hs.rs,n=hs.rq,r=hs.cg.create({getDomNode:function(){if(n=r.domNode){if(n.parentNode===a)return n;r.hide()}var t={},e={ticks:[t,t,t,t,t,t,t,t]},n=o.createLoading(e).domRoot;return a.appendChild(n),n}}),n.close.attach(function(){a=null}),{start:function(t,e){a=t,r.start(e)}})),hs.ru=ms.wwh1ESQ||(ms.wwh1ESQ=(i=hs.jo,s=hs.rr,c=hs.i,l=hs.f,d=hs.bf,u=hs.rq,B=0,z=D=!1,q="tbd",O="u",j={mark:2,describe:8,reportSpam:16,del:32,setMain:64,setCover:128,openTopic:256,vote:1024,blockUser:2048,notInfo:4096,addBookmark:8192,viewPins:16384,exitContest:32768,removeCover:65536,adjustCover:1<<17,inviteToDuel:1<<18},V={},gs(),u.close.attach(function(){if(x){for(var t=Object.keys(P),e=0;e<t.length;e++)p[t[e]]=null;B=0,P={},_=null}}),{photo:function e(n,o){var a=c.start(),t=p[n];function r(){var t=p[n];t?a.resolve(t):o?a.reject():a.join(e(n,!0))}return t?a.resolve(t):(h&&!o||(h=Cs(n,w)),h.then(r,r)),a},nextPhotoId:function(t){return ws(A,t)},previousPhotoId:function(t){return x?c.resolved:ws(I,t)},viewerId:function(){return m},context:function(t){return g=t.albumId,f=t.ownerId,v=t.groupId,this},order:function(t,e){if(b){if(d.areEqual(t,M))return;b&&gs()}t&&(e||1<t.length)&&(ys(t,!0),M=t,b=!0,E=e)},addOrder:ys,cleanAll:gs,replace:function(t,e){p[t.id]=e},stores:function(t){return p[t.id]===t},forget:function(t){var e=t.id,n=(o=A[e])==(a=I[e]),o=n?null:o,a=n?null:a;p[e]=null,o&&a&&(A[a]=o,I[o]=a),xs(A,e,o),xs(I,e,a)},cleanRejected:function(){V={}},setNextPreviousEnabled:function(t){S=t},setViewMode:function(t){C!=t&&(C=t,gs())},getViewMode:function(){return C},setPhotoStreamUserId:function(t){y!=t&&(y=t,gs())},setIsGroupPhotoStream:function(t){D!=t&&(D=t,gs())},setChatMessageId:function(t){w!=t&&(w=t)},getChatMessageId:function(){return w},setPhotoWallData:function(t,e,n,o){x=t,_=e,z=n,k=o},getPhotoWallContestId:function(t){return P[t.id]},isPhotoWallParticipating:function(){return z},setLogActivityId:function(t){R=t},put:bs,sealOrder:function(){function n(t,e){var n=t[e];n&&n!=q||(t[e]=O)}l(p,function(t,e){n(A,e),n(I,e)})},refetchPhoto:function(t){var e=this;return e.replace(s.photo,null),e.photo(t).then(function(t){e.replace(s.photo,t),s.photo=t},function(){})}})),hs.rv=ms.ln53ObA||(ms.ln53ObA=hs.fa.create("photo")||T),hs.rw=ms.p784cw||(ms.p784cw=(W=hs.ah,F=L=!1,U=[],ks(),{busy:ks,listenToIdle:function(){ks(),F||(F=!0,W.touchStartPreview.attach(function(){L=!0}),W.touchEndPreview.attach(function(){L=!1,ks();var t=U;U=[];for(var e,n=0,o=t.length;n<o;n++)e=t[n],setTimeout(_s.bind(0,e),e.time)}))},toIdle:function(t,e){_s({fn:t,time:e})}})),hs.rx=ms.gDdxRfg||(ms.gDdxRfg=(Q=hs.n,X=hs.ah,Z=hs.rv,Y=hs.rr,K=hs.rq,G=hs.rw,J=hs.d,Z.config.attach(function(){$=Y.gifBtn}),Z.appendPipeline(function(t){var e;tt=t&&t.photo,et=tt&&tt.gif,Y.gifIsPlaying=!1,As(et),nt&&(e=nt.parentNode,nt=null,J.gifPlayer.stop(e)),Y.picture&&Q.switchClass(Y.picture.box,et,"gif")}),K.init.attach(Ps.bind(0,"attach")),K.close.attach(Ps.bind(0,"detach")),{go:function(){var t=J.gifPlayer;et&&t&&(nt=Y.picture.img,Y.gifIsPlaying=t.touch(Y.picture.img,!0,tt.gif).isPlaying)}})),hs.ry=ms.pyVreyQ||(ms.pyVreyQ={create:function(){var o,a,r,i,s,c,l,d,u,p=0,h=ot;function n(t){return t*t}function m(t,e){return Math.sqrt(n(e.x-t.x)+n(e.y-t.y))}function f(){var t=1;d=u?(t=(1+m(a,i))/(1+m(o,r)),s=(r.x+o.x)/2,c=(r.y+o.y)/2,l=(i.x+a.x)/2,(i.y+a.y)/2):(a=a||o,s=o.x,c=o.y,l=a.x,a.y);var e={x:l-s,y:d-c,cx:l,cy:d,zoom:t},n=(new Date).getTime();return 100<n-p&&(h=e,p=n),e}function v(t,e){a=o=t,i=r=e||t,u=null!=e,h=ot,p=(new Date).getTime()}return{note:function(t,e){o||v(t,e);var n=null!=e;r=n?u?r:e:o,a=t,i=(u=n)?e||i:t},noteDistance:function(t,e){var n=e/2,o={x:t.x-500,y:t.y},a={x:t.x+500,y:t.y},r={x:o.x-n,y:o.y},i={x:a.x+n,y:a.y};this.note(o,a),p=0,this.note(r,i)},peek:f,reset:v,pop:function(){if(!o)return ot;var t=h,e=f(),n=1+m(e,t)/500;return v(),e.x*=n,e.y*=n,e.zoom*=Math.max(.01,e.zoom-t.zoom+1),o=a=null,e}}},none:ot={x:0,y:0,cx:0,cy:0,zoom:1}}),hs.rz=ms.cgWxdKg||(ms.cgWxdKg=(at=hs.af,{detect:function(){return rt||(t=!1,(!(e=at.androidVersion)||4.1<=e.number)&&(!at.iOS||10<=at.iOSVersion)&&(t=!0),rt={fixed:{isGood:t,top:0,bottom:0}});var t,e}})),hs.sa=ms.q1Klw0w||(ms.q1Klw0w=(it=hs.n,st=hs.o,ct=hs.ah,lt=hs.es,dt=hs.ea,ut=hs.af,pt=hs.jv,ht=hs.rq,mt=hs.rr,ft=hs.be,Ms.prototype={quickCommentInput:{tap:function(){},blur:function(){var t=this;setTimeout(function(){it.removeClass(fs.body,"__layer-kbrd"),ut.iOS&&setTimeout(function(){var t=T.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,T,0),T.dispatchEvent(t)},25),(t.dom.quickCommentInput.value||"").replace(/^\s+/,"").replace(/\s+$/,"")||it.addClass(t.dom.quickCommentEnvelope,"dsn"),fs.getElementsByClassName("np_ctrls-bottom")[0].style=""},5)},focus:function(){var e=this;function t(){it.addClass(fs.body,"__layer-kbrd");var t=e.dom.quickCommentEnvelope;it.removeClass(t,"dsn")}ut.iOS?setTimeout(function(){t(),setTimeout(function(){var t=fs.getElementsByClassName("np_ctrls-bottom")[0];e.domRoot.hasAttribute("data-ios-touched")||(t.style.bottom=(ut.iPhoneXSeries?ft.iosXSeriesApproxKeyboardHeight:ft.iosApproxKeyboardHeight)+"px")},125)},25):t()},keyDown:function(t){13===t.keyCode?(this.sendQuickComment.tap.call(this,t,t.target,!0),t.target.blur()):(ct.allowDefault(t),ut.iOS&&12<=ut.iOSVersion&&this.domRoot.setAttribute("data-ios-touched",""))}},openCommentList:{tap:function(){var t;(t=fs.querySelector(".hint_body[data-hint=qpc]"))&&ct.getOrMakeBehavior(t).close(),Es(!1)}},closeCommentList:{tap:function(){Es(!0)}},sendQuickComment:{tap:function(t,e,n){var o,a,r,i,s,c,l=this,d=(st.parentBySelector(l.domRoot,".widget-list")||l.domRoot.querySelector(".widget-list")).querySelector(".widget-list_infos_i.__COMMENT .ic_tx"),u=mt.photo.commentsSent||0;u>=ht.options.maxQuickCommentsPerMinute?dt.show(l.data.limitViolationMessage,5e3):(o=l.data.commonErrorMessage,a=l.dom.quickCommentInput,r=fs.getElementsByClassName("np_ctrls-quick-comments")[0],i=st.parentBySelector(e,".quick-photo-comment_container"),(s=(e.textContent||a.value).replace(/^\s+/,"").replace(/\s+$/,""))&&(it.addClass(i,"ld"),Es(!0),c=d.currentCommentCount||this.data.previousCommentCount,lt.run("photos.quick.comment",{discussionSubjectId:this.data.discussionSubjectId,discussionTypeId:this.data.discussionTypeId,previousCommentCount:c,commentText:s,section:a.value?null:l.data.section}).then(function(t){t&&t.success?(n&&(a.value=""),r.insertAdjacentHTML("beforeend",t.html),d.textContent=t.commentLabelHtml,d.currentCommentCount=c+1,mt.photo.commentsSent=u+1,setTimeout(function(){it.remove(r.firstChild)},3e3),setTimeout(function(){mt.photo&&0<mt.photo.commentsSent&&mt.photo.commentsSent--},6e4)):dt.show(o,5e3)},function(){dt.show(o,5e3)}).anyway(function(){it.removeClass(i,"ld")})))}},sendUserComment:{tap:function(t,e){it.addClass(this.dom.quickCommentEnvelope,"dsn"),ct.getOrMakeBehavior(e).sendQuickComment.tap.call(this,t,e,!0)}}},ct.register("quickPhotoComment",Ms),{dismissKeyboard:function(){var t=fs.getElementsByClassName("quick-photo-comment_txarea")[0];t&&(t.blur(),it.removeClass(fs.body,"__layer-kbrd"))}})),hs.sb=ms.lxl85ew||(ms.lxl85ew=function(t,e,n,b,a,C,r,o,y,w,i,s,c,l,x){var d=c.desktop,_=c.androidVersion&&c.androidVersion.number<4;function u(){fs.body,0;var t=e.createLayer({});r.listenPreventable(t.domRoot),this.domRoot=t.domRoot,b.layer=this,b.gifBtn=t.gifBtn}function p(t,e){t.style.top=e.scrollTop+"px",t.style.height=e.height+"px"}function h(){}function k(t){return d?0:1<t?1:t<-1?-1:t}u.prototype={progress:function(t){n.start(this.domRoot,t)},remove:function(){b.transitions.close()},addPic:function(t){this.domRoot.appendChild(t.box)},close:function(){this.remove(),t.photoLayerIsOpen=!1,b.clean()},position:function(t){var e,n=this.domRoot;function o(t){p(n,t)}i.detect().fixed.isGood||(y.addClass(n,"__abs"),p(n,t),s.changed.attach(o),a.close.attachOnce(function(){s.changed.detach(o)})),d&&y.addClass(n,"__desktop"),e=s.recordScroll(),a.close.attachOnce(function(){s.hasScrollTarget()||s.resetScroll(e)})},resetNavigationPath:function(t){d&&y.removeClass(this.domRoot,"__with-"+t)},accountAdjacent:function(t){d&&y.addClass(this.domRoot,"__with-"+t)},getBehavior:function(){return r.getOrMakeBehavior(this.domRoot)}};var m,f,A=new Date,I=new Date,N=new Date,P=o.create(),M=null,E=!0;function v(t){var e=w.touches(t);P.note(e[0],1<e.length?e[1]:null)}function g(t){var e=b.picture.foldAnim;return.01<Math.abs(1-t.zoom*(e?e.getZoom():1))||a.options.isCropMode}function S(t){return!t||g(t)?0:t.x/b.viewport.width}function T(t){return!t||g(t)?0:t.y/b.viewport.height}function R(t){var e=b.picture.foldAnim;return e.isInRange(t)?(f=!0,m=t):(f&&e.panAndZoom(),P.pop(),f=!1,m)}function D(t){E=t;var e=b.controls;e&&e.setVisible(t)}return(h.prototype={root:{touchStart:function(t){c.ie||r.allowDefault(t),l.close.trigger(),A=new Date,m=null,f=!1;var e=b.next,n=b.previous;e&&e.markActive(!0).emphasize(!0),n&&n.markActive(!0).emphasize(!0);var o=fs.activeElement;o&&"TEXTAREA"==o.tagName&&o.blur(),v(t)},wheel:function(t){this.handleWheel(t)},touchMove:function(t){var e,n,o,a,r,i,s,c,l,d,u;I=new Date,v(t),b.picture&&(o=S(n=R(e=P.peek())),a=T(n),r=b.picture,i=b.next,s=b.previous,c=k(o),l=Math.abs(e.y),d=Math.abs(e.x),u=(null!=M?M:d<l)&&!y.hasClass(vs,"app"),null==M&&(10<l||10<d)&&(M=u)&&!g(e)&&D(!1),M&&!E&&g(e)&&D(!0),i&&(o<0&&!u?i.fold(-1.05-c):i.fold(-1)),s&&(0<o&&!u?s.fold(1.05-c):s.fold(1)),r.foldAndFade(u?0:-c,u?a:0,n))},touchEnd:function(t){var e=b.picture,n=M,o=w.touches(t),a=new Date-N<400,r=y.hasClass(vs,"app");if(t.touches&&0!=t.touches.length||(N=new Date),E=!(M=null),e){var i,s,c=P.pop(),l=R(c),d=k(S(l)),u=b.next,p=b.previous,h=!1,m=!1,f=y.hasClass(fs.body,"__layer-kbrd");if(n&&!r){var v=Math.abs(T(c));if(0!=v){if(.12<v){var g=e.foldAnim;return g&&(g.cleanStyle(),f&&y.removeClass(fs.body,"__layer-kbrd")),void b.controls.close()}D(!(d=0))}}.12<d&&p?(e.fold(-1),p.unfold().emphasize(!1).activate(),h=!0):d<-.12&&u?(e.fold(1),u.unfold().emphasize(!1).activate(),m=!0):(!a||e.photo.gif||_||f||1==o.length&&(i=l&&e.foldAnim&&1.05<e.foldAnim.getZoom()*l.zoom,P.noteDistance(o[0],i?-500:500),s=P.pop(),i&&(s.zoom=1/e.foldAnim.getZoom()),l=R(s)),e.unfold(l),h=m=!0,I.getTime()-A.getTime()<300&&C.go()),f&&x.dismissKeyboard(),h&&u&&u.emphasize(!1).fold(-1),m&&p&&p.emphasize(!1).fold(1)}}},handleWheel:function(t){var e,n,o=b.picture,a=w.touches(t);o&&(e=(t.deltaY||t.deltaX||t.wheelDelta||0)*(1===t.deltaMode?40:2===t.deltaMode?120:1),P.noteDistance(a[0],-e),n=R(P.pop()),o.unfold(n))}}).root.touchStart.captureTarget=!0,r.register("layer",h),{create:function(){return t.photoLayerIsOpen=!0,new u}}}(hs.d,hs.rs,hs.rt,hs.rr,hs.rq,(hs.ru,hs.rx),hs.ah,hs.ry,hs.n,(hs.cf,hs.ae),hs.rz,hs.bd,hs.af,hs.fz,hs.sa)||T),hs.sc=ms.av8YsxQ||(ms.av8YsxQ=(vt=hs.d,gt=hs.ru,bt=hs.f,Ct=hs.o,{extract:function(t){var e="data-photos",n=t.parentElement,o=n&&n.hasAttribute(e)?n.getAttribute(e):Ct.parentBySelector(t,"div["+e+"]",fs.querySelector(".l.discus_list")).getAttribute(e);if(o){var a,r=JSON.parse(o);if(r&&r.map)return vt.messaging&&vt.messaging.config().attachThroughScrollingEnabled?(a=Ct.parentBySelector(t,".discus_list_w").id,gt.setChatMessageId(a),gt.addOrder(r.order,!1)):(bt(r.map,function(t){t.msgId="present"}),gt.put(r),gt.sealOrder()),!0}return!1}})),hs.sd=ms.aggByqQ||(ms.aggByqQ=(hs.d,yt=hs.ru,hs.f,wt=hs.o,{extract:function(t){var e="data-photos",n=wt.parentBySelector(t,"["+e+"]"),o=n?n.getAttribute(e):null;if(o){var a=JSON.parse(o);if(a&&a.map)return yt.put(a),yt.addOrder(a.order,!0),!0}return!1}})),hs.se=ms.cJunuGw||(ms.cJunuGw=(xt=hs.i,_t=hs.e,{createFactory:function(t,e,n){var o;return function(){return o=o||function(o,t,a){a=a||sessionStorage;var e,n=t().then(function(t){try{a[o]=JSON.stringify(t)}catch(t){}var e=this,n=e.onSync;_t(n||[],function(t){xt.runCallback(e,t)})});try{e=JSON.parse(a[o])}catch(t){}return e&&(n=xt.start().resolve(e)),n.synced=Ss,n}(t,e,n)}}})),hs.sf=ms.pR2vi4w||(ms.pR2vi4w=(kt=hs.jo,At=hs.se,It=hs.rs,Pt=At.createFactory("photoTexts",kt.texts),(Mt={get:function(){return Nt=Nt||Pt().synced(Ts)}})||T)),hs.sg=ms.mTxChRg||(ms.mTxChRg=function(){var v=fs,t={},g="visuals";function e(t,e){var n,o,a,r,i,s,c,l,d,u,p,h,m={ns:g},f=v.createDocumentFragment();return t.href&&((n=v.createElement("a")).className=t.className+" menu-link __allow-click",n.href=t.href,n.target="_blank",n.setAttribute("data-func",t.func),n.setAttribute("role","menuitem"),null!=t.avatarSrc&&((o=v.createElement("span")).className="u-ava",(a=v.createElement("span")).className="u-ava_img",a.setAttribute("style","background-image: url('"+t.avatarSrc+"')"),o.appendChild(a),n.appendChild(o)),(r=v.createElement("span")).className="ic_tx",i=v.createTextNode(t.text),r.appendChild(i),n.appendChild(r),t.rightIconFunc&&((s=v.createElement("span")).className="menu-icon-button",s.setAttribute("data-func",t.rightIconFunc),n.appendChild(s)),f.appendChild(n)),t.href||((c=v.createElement("a")).className=t.className+" menu-link",c.setAttribute("data-func",t.func),c.setAttribute("role","menuitem"),null!=t.avatarSrc&&((l=v.createElement("span")).className="u-ava",(d=v.createElement("span")).className="u-ava_img",d.setAttribute("style","background-image: url('"+t.avatarSrc+"')"),l.appendChild(d),c.appendChild(l)),(u=v.createElement("span")).className="ic_tx",p=v.createTextNode(t.text),u.appendChild(p),c.appendChild(u),t.rightIconFunc&&((h=v.createElement("span")).className="menu-icon-button",h.setAttribute("data-func",t.rightIconFunc),c.appendChild(h)),f.appendChild(c)),f.okData={moreMenuItem:t},f.okView="moreMenuItem",m.domRoot=f,m}t.createMoreMenu=function(t,e){var n={ns:g},o=v.createElement("div");return o.className=t.className||"flow-menu",o.setAttribute("role","menu"),a(t.items,o),o.okData={moreMenu:t},o.okView="moreMenu",n.domRoot=o,n},t.createMoreMenuItem=e;var a=function(t,e,n){for(var o=v.createDocumentFragment(),a=0,r=e.length;a<r;a++)o.appendChild(t(e[a],a).domRoot);n.appendChild(o)}.bind(null,e);return t.appendMoreMenuItemsTo=a,t}()||T),hs.sh=ms.mOK6f5g||(ms.mOK6f5g=(Et=hs.n,St=hs.ah,Tt=hs.sg,Dt="__open",Bt=500,{show:function(t,e,n){Ds(e,t);var c=Tt.createMoreMenu({items:n,className:Rt}).domRoot;e[Rs(t)]=c,e.insertBefore(c,e.firstChild);var o,a,r,l=(o=c,a=t,r=e,function(){Et.removeClass(o,Dt),setTimeout(Ds.bind(0,r,a,o),Bt)});return setTimeout(function(){var t,e,n,o,a,r,i,s;Et.addClass(c,Dt),St.tapPreview.attachOnce(function(){l()},0),t=c,e=Et.getTotalOffsetTop(t),n=t.offsetHeight,o=e+n,a=T.getComputedStyle(t),r=parseFloat(a.marginTop),i=vs,(s=(fs.body.scrollTop||i.scrollTop)+i.clientHeight)<o&&(t.style.marginTop=r+s-o+"px")},10),{hide:l}},autoHide:function(t,e){setTimeout(t.hide,e||2500)},resetClass:function(){this.setClass(null)},setClass:function(t){Rt=t},getClass:function(){return Rt}})),hs.si=ms.pcSIpLg||(ms.pcSIpLg=(zt=hs.sh,qt=hs.sf,hs.rq,{show:function(t,e){Ot=qt.phrases;var n=[];return n.push({className:"__name",avatarSrc:e.avatarSrc,text:e.label,func:"ignoreFunc"}),e.canAccept&&n.push({className:"__mod",text:Ot.processPinMenu.accept,func:"acceptPin"}),e.canDecline&&n.push({className:"",text:Ot.processPinMenu.decline,func:"deletePin"}),zt.resetClass(),zt.show("pinMenu",t,n)}})),hs.sj=ms.pGsUXdw||(ms.pGsUXdw=(jt=hs.rr,Vt=hs.ru,Wt=hs.rq,{refreshPins:function(){var e=jt.picture;Vt.refetchPhoto(jt.photo.id).then(function(t){e.photo=t,Wt.pinProcessed.trigger(e)},function(){})}})),hs.sk=ms.anmI9Q||(ms.anmI9Q=(hs.fa,Ht=hs.rr,Lt=hs.n,hs.sf,Ft=hs.rs,Ut=hs.ah,Qt=hs.jo,Xt=hs.ru,Zt=hs.si,Yt=hs.sj,Kt=hs.rq,Gt=1e4,zs.prototype={acceptPin:{touchStart:function(t){Qt.acceptCustomPin(Ht.photo.id,this.pin.pinUserId,this.pin.x,this.pin.y),Yt.refreshPins()},tap:function(){}},deletePin:{touchStart:function(){var t;Qt.deleteCustomPin(Ht.photo.id,this.pin.pinUserId),1==Ht.photo.pins.length&&(Ht.modPin=!1,(t=Ht.controls&&Ht.controls.view)&&Lt.removeClass(t.dom.footer,"hidden")),Yt.refreshPins()},tap:function(){}},touchPin:{touchStart:function(){this.element.style.zIndex=Gt++},tap:function(){}},pinMenu:{touchStart:function(t){this.element.style.zIndex=Gt++,Zt.show(this.element,this.pin)},tap:function(){}}},Ut.register("acceptPinNew",zs),Kt.pinProcessed.attach(Bs),{init:Bs})),hs.sl=ms.pxr2MZg||(ms.pxr2MZg=(Jt=hs.rv,$t=hs.ah,te=hs.eo,{listenToPage:qs,create:function(t,e,n,o){$t.register(t,e),qs(n,o)},onPhotoUpdate:function(){te.accountStateUpdate()}})),hs.sm=ms.cdmKP8A||(ms.cdmKP8A=function(t,n,m,f,v,g,b,C){var o,y,i,w=[],s="px solid rgba(0,0,0,0.5)",c=32;function l(t){var e=w.left=Math.floor(t/2);y.style.borderLeft=e+s;var n=w.right=Math.ceil(t/2)+1;y.style.borderRight=n+s}function e(){}e.prototype={acceptCrop:{tap:function(){function t(){g.forget(d),m.options.isCropMode=!1,p?b.change(p):b.change("/profile/"+u)}var e,n=f.picture.size,o=f.picture.foldAnim.currentOffsets(),a=n.width*o.zoom,r=n.height*o.zoom,i=Math.abs(o.x-w.left)/a,s=(-o.x+w.right+y.clientWidth)/a,c=Math.abs(w.top-o.y)/r,l=(Math.abs(w.top-o.y)+y.clientHeight)/r,d=f.photo,u=d.ownerId,p=m.options.profileLinkWithOfferBattleDialog,h=v.setMain(d.id,null).then(function(t){p=p||t.profileLinkWithOfferBattleDialog});y.getAttribute("style")?(e=v.cropPhoto(d.id,i,c,s,l),C.all(h,e).then(t)):h.anyway(t)}},declineCrop:{tap:function(){g.forget(f.photo),m.options.isCropMode=!1,T.history.go(-2)}}};return T.addEventListener("popstate",function(){f&&m.options.isCropMode&&(m.options.isCropMode=!1,b.change("/profile/"+i))}),t.create("cropMask",e,function(t){var e=n.createCropMask();t.domRoot.appendChild(e.domRoot),o=e.domRoot,y=o.getElementsByClassName("crop-mask")[0]},function(t){}),{init:function(t){var e,n,o,a,r;m.options.isCropMode&&(e=t.size.zoom,n=t.img,i=f.photo.ownerId,n.clientHeight<n.clientWidth?(y.style.height=Math.round(t.size.height*e)+"px",o=w.top=Math.round(t.size.y),y.style.borderTop=o+s,a=w.bottom=T.innerHeight-o-Math.ceil(n.clientHeight*e)+1,y.style.borderBottom=a+s,l(T.innerWidth-Math.round(t.size.height))):(r=Math.round(t.size.width*e),y.style.height=r+"px",function(t){var e=w.top=Math.ceil(t/2)-c;y.style.borderTop=e+s;var n=w.bottom=Math.floor(t/2)+c+1;y.style.borderBottom=n+s}(T.innerHeight-r),l(T.innerWidth-r)))}}}(hs.sl,hs.rs,hs.rq,hs.rr,hs.jo,hs.ru,hs.ee,(hs.e,hs.i))||T),hs.sn=ms.rsflY4g||(ms.rsflY4g={create:function(){var o,a=[];function e(){var t=a;a=[],o=null;for(var e=0,n=t.length;e<n;e++)t[e]()}return{schedule:function(t){a[a.length]=t,o=o||requestAnimationFrame(e)},cancelAnimationFrame:function(){return o&&cancelAnimationFrame(o)}}}}),hs.so=ms.pU70tbg||(ms.pU70tbg=function(a,A,I,r,N,P,i,M,s,c,E,l,t){var S=32,h=M.androidVersion&&M.androidVersion.number<4?1:1.2;function e(t){var C,p,h,m,f,v,y,g,w,b,e=a.createPicture();function n(){h=!1;var t,e,n,o,a,r,i,s=A.viewport,c=C.size,l=C.box,d=f,u=d%1==0&&v%1==0;s&&c&&(t=c.zoom,g!=(e=b||u&&!p?"":"none")&&P.setStyle(l,g=e),p?(n=k()).zoom<w&&(a=c.x+n.x,r=c.y+n.y,o=t*n.zoom,N.moveAndScale(l,a,r,o),m={x:a,y:r,zoom:o}):(a=c.x-s.width*d,r=c.y+s.height*v,l.parentNode&&M.iOS&&I.hasClass(fs.body,"__layer-kbrd")&&((i=fs.getElementById("qpc-input-root"))&&i.hasAttribute("data-ios-touched")&&(r=Math.abs(l.parentNode.getBoundingClientRect().top))),m={x:a,y:r,zoom:t},N.moveAndScale(l,a,r,t)),b=!1,0),d!=f&&x()}function x(){h||d.schedule(n),h=!0}function o(t,e){if(!C.size)return!0;var n=k(t,e),o=n.zoom;if(w<o||o<1)return!1;var a,r,i=A.viewport,s=C.size,c=s.zoom*o,l=s.width*c,d=s.height*c,u=i.width,p=i.height,h=.5+Math.min(.47,(c-1)/6),m=1-h,f=-s.x-l+u*h,v=-s.y-d+p*h,g=-s.x+u*m,b=-s.y+p*m;return!E.options.isCropMode||(a=fs.getElementsByClassName("crop-mask")[0])&&(d<l?(b=0,v=-(d-s.height*s.zoom),f=u-l-(g=_(a,"borderLeftWidth"))-s.x,g-=s.x):(g=0,f=-(l-s.width)-s.width*(1-s.zoom),r=s.height*(1-s.zoom),v=-(b=_(a,"borderTopWidth")-(p-s.height)/2+S-r/2)-s.height*(c-1)-r)),n.x=Math.min(g,Math.max(f,n.x)),n.y=Math.min(b,Math.max(v,n.y)),t.sumBase=y,t.sum=n,!0}function _(t,e){var n=T.getComputedStyle(t)[e];return parseInt(n.substring(0,n.indexOf("px")))}function k(t,e){if(e=e||b,(t=t||p).sum&&t.sumBase==y)return t.sum;var n=t.zoom,o=C.size,a=o.x+y.x-t.cx,r=o.y+y.y-t.cy,i=n-1,s=n*y.zoom,c=t.x+y.x+a*i,l=t.y+y.y+r*i;return e&&!E.options.isCropMode&&Math.abs(1-s)<.1&&(l=c=0,s=1),{x:c,y:l,cx:0,cy:0,zoom:s}}this.box=e.domRoot,this.img=e.img,this.photo=t,this.foldAnim=(C=this,v=f=0,y=i.none,g="",b=!(w=4),{redo:n,setFinal:function(){b=!0},cleanStyle:function(){var t=C.box;t&&P.setStyle(t,"")},to:function(t,e,n){t==f&&e==v&&!n||((p=n)&&!E.options.isCropMode&&p.zoom<=1.05&&y&&y.zoom<=1.05&&(p=null,y=i.none),f=t,v=e,C.size&&x())},panAndZoom:function(){p&&(o(p,!0),y=p.sum,p=i.none)},getZoom:function(){return y&&y.zoom||1},currentOffsets:function(){return m},isInRange:o}),this.pinsBox=e.pinsBox}function m(t,e){var n,o=t.photo&&t.photo.msgId,a=e.height-(o?0:64);return t.box&&M.iOS&&I.hasClass(fs.body,"__layer-kbrd")&&((n=fs.getElementById("qpc-input-root"))&&!n.hasAttribute("data-ios-touched")&&t.box.parentNode&&(a-=M.iPhoneXSeries?l.iosXSeriesApproxKeyboardHeight:l.iosApproxKeyboardHeight)),a}e.prototype={load:function(e,n){var o=this.img,t=r.load(e),a=this;return(a.loadTask=t).then(function(t){a.loadTask=null,o.src=e,a.setSize(t),!n||a!=A.picture&&a!=A.previous&&a!=A.next||a.prepareToRender()},function(){a.retryLoad=a.load.bind(a,e,n)}),t},setSize:function(t){var e=t.naturalHeight,n=t.naturalWidth,o=A.viewport||{width:1,height:1},a=o.width,r=m(this,o),i=Math.min(a,n),s=i*e/n;r<s&&(i=(s=r)*n/e),this.size={width:i,height:s,naturalWidth:n,naturalHeight:e,x:0,y:0,zoom:1};var c=this.img.style;c.width=i.toFixed()+"px",c.height=s.toFixed()+"px"},move:function(t,e,n){N.moveAndScale(this.box,t,e,n)},fold:function(t,e){this.foldAndFade(t,0,e)},foldAndFade:function(t,e,n){this.foldAnim.to(t,e,n)},unfold:function(t){var e=this.foldAnim;return e.setFinal(),this.fold(0,t),e.panAndZoom(),this},emphasize:function(t){return this},remove:function(){P.startRemoval(this.box,{__obsolete:!0})},dispose:function(){I.remove(this.box)},zoom:function(){var t,e,n,o,a,r,i,s,c,l,d,u=this.size,p=A.viewport;u&&p&&(t=p.width,e=m(this,p),n=u.width,o=u.height,r=.85*t<(a=u.naturalWidth*h)?t:a,l=t/2-(c=(s=t<n*(i=e/o)?t/n:i)*Math.min(1,r/(n*s)))*n/2,d=e/2-o/2*c,u.zoom=c,u.x=l,u.y=d,this.foldAnim.redo(),this.showAsIs())},showAsIs:function(){I.addClass(this.box,"__shown")},markActive:function(t){return this.box.style.visibility=t?"visible":"hidden",this},prepareToRender:function(){var t=this,e=A.layer;e&&(t.zoom(),t.markActive(!0),n(function(){e.addPic(t)}))},activate:function(){var t,e,n=A.picture,o=A.next,a=A.previous;return this.markActive(!0),A.activatedPicturesCount++,this==a?(t=n,o&&o.dispose()):this==o&&(e=n,a&&a.dispose()),A.picture=this,A.next=t,A.previous=e,E.pictureSelected.trigger(this),this.retryLoad&&this.retryLoad(),this.loadTask&&A.layer.progress(this.loadTask),s.init(this),c.init(this),this}};var n=T.requestAnimationFrame||T.webkitRequestAnimationFrame||T.mozRequestAnimationFrame||function(t){return setTimeout(t,0)},d=t.create();return{create:function(t){return new e(t)}}}((hs.d,hs.rs),hs.rr,hs.n,(hs.i,hs.lp),hs.ar,hs.cf,hs.ry,hs.af,hs.sk,hs.sm,hs.rq,hs.be,hs.sn)||T),hs.sp=ms.c5CeWVA||(ms.c5CeWVA=(ee=hs.sh,ne=hs.sf,oe=hs.rq,{show:function(t,e){ae=ne.phrases;var n=[],o=e.can;return o.setCover&&oe.openedFromAlbum&&n.push({className:"ic ic-acvr",text:ae.setCover.do,func:"setCover"}),o.setMain&&n.push({className:"ic ic-covr",text:e.albumId?ae.setMain.doAlbum:ae.setMain.do,func:"setMain"}),o.describe&&n.push({className:"ic ic-edit",text:ae.descr.edit,func:"descr"}),o.info&&n.push({className:"ic ic-info",text:ae.info.do,func:"info"}),o.reportSpam&&n.push({className:"ic ic-warn",text:ae.spam.do,func:"spam"}),o.del&&n.push({className:"ic ic-del",text:ae.del.do,func:"del"}),o.blockUser&&n.push({className:"ic ic-blck",text:ae.block.do,func:"blockUser"}),o.addBookmark&&n.push({className:"ic ic-bmark",text:ae.addBookmark.do,func:"addBookmark"}),o.exitContest&&n.push({className:"ic ic-exit",text:ae.exitContest.do,func:"exitContest"}),o.removeCover&&n.push({className:"ic ic-del",text:ae.removeCover.do,func:"removeCover"}),o.adjustCover&&n.push({className:"ic ic-acp __gray",text:ae.adjustCover.do,func:"adjustCover"}),o.inviteToDuel&&n.push({className:"ic ic-duel __new",text:ae.inviteToDuel.do,func:"inviteToDuel"}),ee.resetClass(),ee.show("photoMenu",t,n)}})),hs.sq=ms.d3Vj4eg||(ms.d3Vj4eg=function(){var l=fs,t={},d="visuals";function e(t,e){var n={ns:d},o=l.createElement("a");o.setAttribute("role","button"),o.className="dialog_action_button "+(t.className||""),o.setAttribute("data-func",t.func);var a=l.createTextNode(t.text);return o.appendChild(a),o.okData={dialogButton:t},o.okView="dialogButton",n.domRoot=o,n}t.createDialog=function(t,e){var n={ns:d},o=l.createElement("div");o.className="nl_modal "+(t.className||""),o.setAttribute("data-func","modal");var a=l.createElement("div");a.className="nl_dlg_w",n.wrapper=a;var r=l.createElement("h3");r.className="nl_title "+(t.titleClass||"");var i=l.createTextNode(t.title);r.appendChild(i),a.appendChild(r);var s=l.createElement("div");s.className="nl_dlg",(n.content=s).setAttribute("data-view-level","doc"),a.appendChild(s);var c=l.createElement("div");return c.className="dialog_action_buttons "+(1<t.buttons.length?"__multichoice __size-"+t.buttons.length:""),n.buttons=c,u(t.buttons,c),a.appendChild(c),o.appendChild(a),o.okData={dialog:t},o.okView="dialog",n.domRoot=o,n},t.createDialogButton=e;var u=function(t,e,n){for(var o=l.createDocumentFragment(),a=0,r=e.length;a<r;a++)o.appendChild(t(e[a],a).domRoot);n.appendChild(o)}.bind(null,e);return t.appendDialogButtonsTo=u,t}()||T),hs.sr=ms.r8fZ7yw||(ms.r8fZ7yw=function(){var u=fs,t={},p="visuals";function e(t,e){var n={ns:p},o=u.createElement("div");o.className="base-button __modern "+(t.isAccept?"__accept":"__default");var a=u.createElement("a");a.setAttribute("role","button"),a.className="base-button_target",a.setAttribute("data-func",t.func);var r=u.createTextNode(t.text);a.appendChild(r),o.appendChild(a);var i=u.createElement("div");i.className="base-button_bg",o.appendChild(i);var s=u.createElement("div");s.setAttribute("aria-hidden","true"),s.className="base-button_content";var c=u.createElement("div");c.className="base-button_content_text";var l=u.createTextNode(t.text);return c.appendChild(l),s.appendChild(c),o.appendChild(s),o.okData={dialogButton:t},o.okView="dialogButton",n.domRoot=o,n}t.createDialog=function(t,e){var n={ns:p},o=u.createElement("div");o.className="nl_modal __redesign "+(t.className||""),o.setAttribute("data-func","modal");var a=u.createElement("div");a.className="nl_dlg_w",n.wrapper=a;var r=u.createElement("div");r.className="nl_dlg_cnt_w";var i=u.createElement("h3");i.className="nl_title "+(t.titleClass||"");var s=u.createTextNode(t.title);i.appendChild(s),r.appendChild(i);var c=u.createElement("div");c.className="nl_dlg",(n.content=c).setAttribute("data-view-level","doc"),r.appendChild(c),a.appendChild(r);var l=u.createElement("div");l.className="buttons-set";var d=u.createElement("div");return d.className="buttons-set_inner",n.buttons=d,h(t.buttons,d),l.appendChild(d),a.appendChild(l),o.appendChild(a),o.okData={dialog:t},o.okView="dialog",n.domRoot=o,n},t.createDialogButton=e;var h=function(t,e,n){for(var o=u.createDocumentFragment(),a=0,r=e.length;a<r;a++)o.appendChild(t(e[a],a).domRoot);n.appendChild(o)}.bind(null,e);return t.appendDialogButtonsTo=h,t}()||T),hs.ss=ms.dilS1Mg||(ms.dilS1Mg=(re=hs.sq,ie=hs.sr,se=hs.bd,ce=hs.ah,le=hs.cf,de=hs.f,ue=hs.n,pe=hs.a,{show:function(t,e){var n,o=e.titleClass,a=e.content,r=ue.hasClass(fs.body,"js-dialog-redesign");if(a&&!e.isTitleForInput||(e.titleClass=[o||""," ","__over-controls"].join("")),r){if(1<e.buttons.length){for(var i=!0,s=0;s<e.buttons.length;s++)if(e.buttons[s].isAccept){i=!1;break}"function"!=typeof e.buttons.every&&pe.log("non-existent.method.every.failed"),i&&(e.buttons[0].isAccept=!0)}e.buttons.sort(function(t,e){return t.isAccept===e.isAccept?0:t.isAccept?-1:1}),n=ie.createDialog(e)}else n=re.createDialog(e);var c,l=n.domRoot,d=e.onShown,u=e.behavior;return l.okView=e.view,l.style.maxHeight=se.calc().height+"px",a&&n.content.appendChild(a),t.insertBefore(l,t.firstChild),le.start(l,le.css.shown),r&&(this.contentWrapper=n.domRoot.getElementsByClassName("nl_dlg_cnt_w")[0],Os.apply(this),se.resize.attach(Os,this)),d&&le.onEnd(l,d),u&&(c=u.prototype,ce.forbidScroll(c,"modal"),de(c,function(t,e){t&&t.tap&&ce.forbidScroll(c,e)})),this.topmost=l},close:function(t){this.topmost=null,this.contentWrapper=null,le.startRemoval(t,le.css.hidden),se.resize.detach(Os,this)}})),hs.st=ms.d5lRXRg||(ms.d5lRXRg=(he=hs.jo,me=hs.sl,fe=hs.rs,ve=hs.n,ge=hs.rr,be=hs.sf,Ce=hs.ss,ye=hs.ah,we=hs.af,xe=hs.ee,Me=0,Ee=!1,Se="DescrDlg",Te=we.androidVersion&&we.androidVersion.number,Re=!Te||4.1<=Te||we.chrome,Fs.prototype={toggle:{tap:function(t){ye.allowDefault(t),Me<(new Date).getTime()&&(Ne=!Ne,Hs())}}},me.create("description",Fs,function(t){var e=fe.createDescription();_e=e.textBox,ke=_e.parentNode,Ae=ke,(Pe=t.header).appendChild(e.domRoot)},function(t){Ne=Ne&&t==Ie,((Ie=t).useDescriptionHTML?js:Vs)(),Hs()}),Us.prototype={save:{tap:function(){this.close();var t=Ie.description,e=this.textarea.value;Ie.useDescriptionHTML||Ws(e),he.editDescription(Ie.id,Ie.albumId,Ie.groupId,e).then(function(t){var e,n;Ie.useDescriptionHTML&&(e=t.descriptionHTML,n=t.description,Ie.descriptionHTML=e,Ie.description=n,js()),me.onPhotoUpdate()},function(){Ie.useDescriptionHTML||Ws(t)})}},close:ye.handle("tap",function(){Ce.close(this.dialog)})},ye.register(Se,Us),{go:function(){var t,e,n;Re?(t=be.phrases,e=fs.createElement("textarea"),n=t.descr.dialog,e.setAttribute("data-func","text"),e.className="nl_textarea",e.maxLength=255,e.value=Ie.description||"",e.placeholder=n,Ce.show(ge.layer.domRoot,{view:Se,behavior:Us,title:n,className:"__text-edit",buttons:[{className:"__main",text:t.descr.save,func:"save"},{text:t.cancel,func:"close"}],isTitleForInput:!0,content:e,onShown:function(){e.focus()}}),e.focus()):xe.change(Ie.editLink)}})),hs.su=ms.axHAZg||(ms.axHAZg=(De=hs.sl,Be=hs.rs,ze=hs.ru,qe=hs.rq,je=[],De.create("attachSequence",function(){},function(t){var e=Be.createAttachSequence();t.header.appendChild(e.domRoot),Oe=e.indexBox},function(t){t.attachSequenceHtml&&(Oe.innerHTML=t.attachSequenceHtml,je[t.id]=!0)}),qe.adjacentPhotoRequested.attach(function(t){var e,n,o;!ze.getChatMessageId()||je[t.currentPhotoId]||(e=Oe.querySelector(".attach-sequence_from"))&&e.textContent&&(n="previous"===t.direction?1:-1,o=parseInt(e.textContent),e.textContent=o-n)}),T)),hs.sv=ms.pQSObNA||(ms.pQSObNA=(Ve=hs.sl,We=hs.rs,hs.sf,He=hs.n,Le=hs.ru,Ve.create("photowallViewProgress",function(){},function(t){var e=We.createPhotoWallProgress();Ue=e.domRoot,t.header.appendChild(Ue)},function(t){var e,n,o;Fe=t,Le.getPhotoWallContestId(t)&&(e=function(){var t=Qs();if(t)return t.style.width;return 0}(),Ue.innerHTML=Fe.photoWallViewProgressHtml,!e||(n=Qs())&&(n.style.width=e),o=0<Ue.getElementsByClassName("photowall-buy-views").length,He.switchClass(Ue,!o,"__short"),He.removeClass(Ue,"dsn"),He.addClass(Ue.parentNode,"__filled"))}),T)),hs.sw=ms.iBwdxjg||(ms.iBwdxjg=(Qe=hs.es,Xe=hs.ss,Ze=hs.ah,Ye=hs.rr,Ke=hs.sf,Xs.prototype={close:Ze.handle("tap",function(){Xe.close(this.dialog)})},Ze.register("ErrDlg",Xs),{listen:function(){this.listen=function(){},Qe.failed.attach(Zs)}})),hs.sx=ms.dSq6PZQ||(ms.dSq6PZQ=(Ge=hs.rr,Je=hs.rq,$e=hs.sf,tn=hs.ru,en=hs.jo,nn=hs.ss,on=hs.ah,an=hs.n,rn=hs.cf,sn=hs.eo,cn=hs.ee,ln=hs.af,dn=hs.e,Ys.prototype={del:{tap:function(){var o=un;this.close();var t=en.del(o.id,o.groupId).then(function(){var t=Ge.next||Ge.previous,e=Ge.picture;tn.forget(o);var n=Je.findLinksToPhoto(o);dn(n,function(t){an.addClass(t,"deleted-photo"),Ge.refreshOnClose=!0}),t?(rn.onEnd(e.box,function(){e.dispose()}),e.fold(1),Ge.picture=null,t.unfold().activate()):ln.okApp?ln.iOS?T.close():cn.change("/apphook/back"):sn.back()});Ge.layer.progress(t)}},close:on.handle("tap",function(){nn.close(this.dialog),un=null})},on.register("DelDlg",Ys),{go:function(t){un=t;var e=$e.phrases;nn.show(Ge.layer.domRoot,{view:"DelDlg",behavior:Ys,title:e.del.areSure,buttons:[{className:"__warn",text:e.del.yes,func:"del"},{text:e.cancel,func:"close"}],content:null})}})),hs.sy=ms.rnP9ZmQ||(ms.rnP9ZmQ=(pn=hs.rr,hs.rq,hn=hs.sf,mn=hs.ru,fn=hs.jo,vn=hs.ss,gn=hs.ah,hs.n,hs.cf,hs.eo,bn=hs.ee,yn="RemoveCoverDlg",Ks.prototype={removeCover:{tap:function(){var t=Cn;this.close();var e=t.ownerId,n=fn.removeCover(t.id).then(function(){mn.forget(t),bn.change("/profile/"+e)});pn.layer.progress(n)}},close:gn.handle("tap",function(){vn.close(this.dialog),Cn=null})},gn.register(yn,Ks),{go:function(t){Cn=t;var e=hn.phrases;vn.show(pn.layer.domRoot,{view:yn,behavior:Ks,title:e.removeCover.areSure,buttons:[{className:"__warn",text:e.removeCover.yes,func:"removeCover"},{text:e.cancel,func:"close"}],content:null})}})),hs.sz=ms.a6C9dpA||(ms.a6C9dpA=(wn=hs.ee,{go:function(t){wn.change("/adjustCover/"+t.id)}})),hs.ta=ms.sHQ06Hw||(ms.sHQ06Hw=(xn=hs.rr,_n=hs.sf,kn=hs.jo,An=hs.ss,In=hs.ah,Nn=hs.e,Pn=hs.ee,Mn=hs.ru,En=hs.fd,Tn="AvatarDlg",Gs.prototype={go:{tap:function(){var a=Sn;this.close(),kn.setMain(a.id,a.albumId).then(function(t){var e,n,o;t.redirectUrl?(Mn.forget(a),xn.controls.close(),setTimeout(function(){Pn.change(t.redirectUrl)},400)):((e=t.src)&&(n=fs.querySelectorAll(".js-user-main-img"),Nn(n,function(t){t.src=e})),(o=t.dialogContent)&&En.show({url:T.location.href,contentHtml:o,dontPush:!0}))})}},close:In.handle("tap",function(){An.close(this.dialog),Sn=null})},In.register(Tn,Gs),{go:function(r){xn.layer.progress(kn.textsToSetMain(r.albumId).then(function(t){var e,n,o,a;r==xn.photo&&(Sn=r,e=_n.phrases,n=t.warn,An.show(xn.layer.domRoot,{view:Tn,behavior:Gs,title:n||t.areSure,titleClass:n?"__warn":"",buttons:[{className:"__main",text:e.set,func:"go"},{text:e.cancel,func:"close"}],content:n?(o=t.areSure,(a=fs.createElement("span")).textContent=o,a):null}))}))}})),hs.tb=ms.seNa2Ag||(ms.seNa2Ag=(Rn=hs.rr,Dn=hs.sf,Bn=hs.jo,zn=hs.ss,qn=hs.ah,On=hs.e,Vn="CoverDlg",Js.prototype={go:{tap:function(){var a=jn;this.close(),Bn.setCover(a.id,a.albumId,a.groupId).then(function(t){var e,o=t.src;o&&(e=fs.querySelectorAll("img.js-photo-album"),On(e,function(t){var e=t.getAttribute("data-id"),n=t.parentNode;e==a.albumId&&(t.src=o),n&&"A"==n.tagName&&(n.href=n.href.replace(/st\.phoId=\d+/,"st.phoId="+a.id))}))})}},close:qn.handle("tap",function(){zn.close(this.dialog),jn=null})},qn.register(Vn,Js),{go:function(t){jn=t;var e=Dn.phrases;zn.show(Rn.layer.domRoot,{view:Vn,title:e.setCover.areSure,behavior:Js,buttons:[{className:"__main",text:e.set,func:"go"},{text:e.cancel,func:"close"}]})}})),hs.tc=ms.mVdKweg||(ms.mVdKweg=(Wn=hs.rr,Hn=hs.rq,Ln=hs.sf,Fn=hs.jo,Un=hs.ss,Qn=hs.ah,Zn="SpamDlg",$s.prototype={go:{tap:function(){var t=Xn,e=Hn.options.spamTypes;this.close(),Fn.markSpam(t.id,t.groupId?e.groupPhoto:e.userPhoto)}},close:Qn.handle("tap",function(){Un.close(this.dialog),Xn=null})},Qn.register(Zn,$s),{go:function(t){Xn=t;var e=Ln.phrases,n=e.spam;Un.show(Wn.layer.domRoot,{view:Zn,behavior:$s,title:n.areSure,buttons:[{className:"__warn",text:n.do,func:"go"},{text:e.cancel,func:"close"}]})}})),hs.td=ms.iRo7iFA||(ms.iRo7iFA=(Yn=hs.rr,Kn=hs.sf,Gn=hs.jo,Jn=hs.ss,$n=hs.ah,to=hs.bx,eo="InfoDlg",tc.prototype={close:$n.handle("tap",function(){Jn.close(this.dialog)})},$n.register(eo,tc),{go:function(n){var t=Gn.info(n.id,n.albumId,n.groupId).then(function(t){var e;Yn.photo&&Yn.photo.id==n.id&&(e=Kn.phrases,Jn.show(Yn.layer.domRoot,{behavior:tc,view:eo,title:e.info.do,buttons:[{text:e.close,func:"close"}],content:to.createDomTree(t.html)}))});Yn.layer.progress(t)}})),hs.te=ms.b7XEKVg||(ms.b7XEKVg=(no=hs.rr,oo=hs.sf,ao=hs.jo,ro=hs.ss,io=hs.ah,so=hs.bx,lo="BlockUserDlg",ec.prototype={go:{tap:function(){var t=co;this.close(),ao.blockMember.go(t.groupId,t.ownerId)}},close:io.handle("tap",function(){ro.close(this.dialog),co=null})},io.register(lo,ec),{go:function(n){no.layer.progress(ao.blockMember.prepare(n.groupId,n.ownerId).then(function(t){var e;n==no.photo&&(co=n,e=oo.phrases,ro.show(no.layer.domRoot,{view:lo,behavior:ec,title:e.block.do,buttons:[{className:"__warn",text:e.block.do,func:"go"},{text:e.cancel,func:"close"}],content:so.createDomTree(t.html)}))}))}})),hs.tf=ms.aCDq7tQ||(ms.aCDq7tQ=(uo=hs.rr,hs.rq,po=hs.sf,hs.ru,ho=hs.jo,mo=hs.ss,hs.ah,hs.n,hs.cf,hs.eo,hs.e,{go:function(o){var t=ho.addBookmark(o.id,o.groupId).then(function(t){var e,n;uo.photo&&uo.photo.id==o.id&&(e=po.phrases,n=mo.show(uo.layer.domRoot,{view:"AddedBmarkDlg",title:e.addBookmark.done,buttons:[]}),setTimeout(function(){mo.close(n)},2e3))});uo.layer.progress(t)}})),hs.tg=ms.eIUbONg||(ms.eIUbONg=(fo=hs.rr,hs.rq,vo=hs.sf,go=hs.ru,bo=hs.jo,Co=hs.ss,yo=hs.ee,wo=hs.n,xo=hs.af,{go:function(n){var t=go.getPhotoWallContestId(n).photoWallContestId,e=bo.exitContest(n.id,t).then(function(){var t,e;fo.photo&&fo.photo.id==n.id&&(t=vo.phrases,e=Co.show(fo.layer.domRoot,{view:"ExitContestDlg",title:t.exitContest.done,buttons:[]}),setTimeout(function(){Co.close(e),setTimeout(function(){wo.hasClass(vs,"app-fscreen")?xo.iOS?T.close():wo.hasClass(vs,"js-back-hooklink")?yo.change("/apphook/back"):nc():nc()},125)},2e3))});fo.layer.progress(e)}})),hs.th=ms.ic6ahg||(ms.ic6ahg=(_o=hs.ee,{go:function(t){_o.change("/inviteToDuel/"+t.ownerId+"/photo/"+t.id)}})),hs.ti=ms.i2ro2WA||(ms.i2ro2WA=(ko=hs.n,Ao=null,Io=[],No=[],{fetch:function(t){Io.push(t),null===Ao&&(Ao=setTimeout(oc,1e3))}})),hs.tj=ms.m5vA||(ms.m5vA=(function(r,i,n,s,o,c,a,e,l){var d,u,p,h,m,f,v=!1,g=!1,b=[5,4,3,2,1],C=b.concat(),y="5plus";C.unshift(y);var w=C.concat().reverse(),x="__mark-selected",_="__selected";function k(){var t,e;p.can.mark?(i.removeClass(d,"__hidden"),e=t||(p.viewerMark?p.viewerMark:null),null!==m&&m!==e&&(i.removeClass(d,x),f&&i.removeClass(f,_)),null!==e&&(m=e,f=d.querySelector('[data-mark="'+e+'"]'),i.addClass(d,x),i.addClass(f,_))):i.addClass(d,"__hidden")}function t(){}function A(e){o.touchStartPreview.attachOnce(function(t){o.touchEndPreview.attachOnce(function(){setTimeout(function(){g=!1,i.removeClass(d,e),i.removeClass(u,"__marks-open")},25)})})}function I(t){var e=p.viewerMark;p.viewerMark=t;var n,o="__open-for-upgrade";function a(t){t&&t.success?r.onPhotoUpdate():(p.viewerMark=e,t&&t.payUrl&&(location.href=t.payUrl)),k()}c.options.quickPhotoCommentsEnabled&&e&&!i.hasClass(d,o)?e!==y&&(i.addClass(d,o),i.addClass(u,"__marks-open"),A(o)):(n=s.mark(p.id,p.albumId,p.ownerId,!0,t).then(a,a),"5plus"===t?l.layer.progress(n):k())}function N(){i.clear(h);var t=c.options,e=n.createMarks({marks:t.mark5Plus?t.reverseMarks?w:C:b,fivePlus:y});d=e.domRoot,h.appendChild(d),u=a.parentBySelector(d,".np_ctrls-bottom"),v=!0,k()}t.prototype={mark:{touchStart:function(t){I(t.target.getAttribute("data-mark"))}},raiseMark:{tap:function(t){I(t.target.getAttribute("data-raise-mark"))}},open:{tap:function(t){var e,n;g||((e=p.viewerMark)?e!=y&&(n="__open-5plus"):n="__open",n&&(i.addClass(d,n),g=!0,i.addClass(u,"__marks-open"),A(n)))}}},r.create("marks",t,function(t){h=t.marksPanel,f=m=null,v=!1},function(t){p=t,v?k():e.get().synced(N)})}(hs.sl,hs.n,hs.rs,hs.jo,hs.ah,hs.rq,hs.o,hs.sf,hs.rr,hs.e),T)),hs.tk=ms.aucZrVw||(ms.aucZrVw={label:function(t,e,n){n&&(t.title=e),t.setAttribute("aria-label",e)}}),hs.tl=ms.lDyOw||(ms.lDyOw=(Po=hs.jo,{get:hs.se.createFactory("photoLinks",Po.links)})),hs.tm=ms.w1DaRSQ||(ms.w1DaRSQ=(Mo=hs.n,Eo=hs.o,So=hs.ru,To=hs.ah,Ro=hs.ai,Do=hs.r,Bo=hs.ee,zo=hs.bm,rc.prototype.widgetActionHandler={tap:function(t,e){!function(t){var e=Eo.findParent(t,ic,null,5);{var n;e&&((n=e.href||e.getElementsByClassName("__default-link")[0].href)&&Bo.change(n),Do.navigated.attachOnce(So.cleanAll))}}(e.firstChild)}},To.register("photoLayerWidget",rc),Ro.addFuncHandler("shareInLayer",{tap:function(t){var e=Eo.findParent(t.target,function(t){return t.href}),n=e.href,o="_blank"===e.target;n&&(o?T.open(n,"_blank"):(Do.navigated.attachOnce(So.cleanAll),Bo.change(n)))}}),Ro.addFuncHandler("shareImmediate",{tap:function(t){var e,n=Eo.findParent(t.target,function(t){return t.href}),o=n.href;o&&((e=zo.request(o,"POST")).xhr.setRequestHeader("X-immediate-share","1"),e.then(function(){n.querySelector(".toggled-button_item-icon .ic").className="ic ic16 __empty ic-tick __mod",n.querySelector(".toggled-button_item-header").textContent=n.getAttribute("data-immediate-success-label"),Mo.addClass(n,"untouchable")},function(){}).withToken().send())}}),Ro.addFuncHandler("closeActionsMenu",{tap:function(t,e){var n;!Mo.hasClass(e,"toggled-button_item-link")||(n=Eo.parentBySelector(e,".widget-list_i"))&&To.getOrMakeBehavior(n).toggleOff()}}),T)),hs.tn=ms.tSvyUg||(ms.tSvyUg=(qo=hs.sl,Oo=hs.n,jo=hs.rs,hs.jo,Vo=hs.tk,hs.ru,Wo=hs.tl,Ho=hs.sf,hs.ah,Lo=hs.rq,Fo=hs.rr,hs.ee,hs.r,Uo=hs.bk,Qo=hs.cy,hs.tm,Jo=/\bajax-like(?:-info)?_[\d]+\b/,Qo.htmlFromEnvelopeInserted.attach(function(t){var e=function(t){var e,n;if(Ko){n=!1;for(var o=0,a=(e=t.envelopes).length;o<a;o++){var r,i,s,c,l=e[o].contentDomFirst;l&&(r=fs.createElement("DIV"),i=l.className,r.innerHTML=n||Ko.widgetsPanelHtml,i&&(s=Jo.exec(i))&&((c=r.getElementsByClassName(s[0])[0]||fs.getElementsByClassName(s[0])[0])&&(Oo.addClass(l,"js-cached"),c.parentNode.replaceChild(l,c),n=r.innerHTML)))}return Ko.widgetsPanelHtml=n,qo.onPhotoUpdate(),n}}(t);e&&(Ko.widgetsPanelHtml=e)}),qo.listenToPage(function(t){Zo=(Xo=t).boxTopicActions,Yo=t.boxTopActions},lc),Lo.pinProcessed.attach(function(t){lc(t.photo)}),T)),hs.to=ms.c7Ec95A||(ms.c7Ec95A=($o=hs.sl,ta=hs.n,ea=hs.sf,na=hs.rs,oa=hs.jo,aa=hs.rr,uc.prototype={vote:{tap:function(){aa.layer.progress(oa.vote(ia.albumId,ia.id).then(function(t){ia==aa.photo&&(ia.can.vote=!1,ia.votes=t.votes,$o.onPhotoUpdate(),dc())}))}}},$o.create("vote",uc,function(t){ra=t.boxVote},function(t){ia=t,dc()}),T)),hs.tp=ms.sbF7F2g||(ms.sbF7F2g=(hs.n,hs.o,hs.ru,hs.ah,hs.rr,hs.jo,hs.sl,hs.ai,hs.ee,hs.cs,sa=hs.cl,ca=hs.ct,hs.al,la=hs.ap,da=200,ua=la.transform,pa=ca.createGaussRandomizer(),ha=Math.random.bind(Math),ma=ca.createGaussRandomizer(),{launchAnimation:function(t){!function t(e){var n;e.length&&((n=e.pop()).domNode.style.opacity=1,n.run(),setTimeout(function(){t(e)},da))}(function(e,t){for(var n=sa.build,o=fs.createDocumentFragment(),a=e.getAttribute("data-coefficient"),r=[],i=0;i<t;i++){var s=fs.createElement("div"),c=!!(i%2);s.className=c?"photowall-layer_accent-bubble":"photowall-layer_accent-heart",c&&(s.textContent="x"+a),o.appendChild(s);var l=new n(s,pc,{transform:{duration:425,timingFn:hc,group:{translateY:{to:Math.min(-120,48*ha()-192)},translateX:{to:48*pa()},rotate:{to:30*ma()},scale:{from:.425,to:.9,next:{name:"scale-bounce",from:.9,to:.65,delay:0,duration:400,timingFn:mc,next:{name:"scale-end",from:.65,to:0,duration:125}}}}}});l.onAllAnimationsEnd.attachOnce(function(t){e.removeChild(t.animationData)}),l.domNode=s,r.push(l)}return e.appendChild(o),r}(t,5))}})),hs.tq=ms.pczrLBg||(ms.pczrLBg=(fa=hs.n,va=hs.o,ga=hs.ru,ba=hs.ah,Ca=hs.rr,ya=hs.jo,wa=hs.sl,xa=hs.ai,_a=hs.ee,ka=hs.tp,Aa=hs.cu,Ia=hs.fd,Na=hs.er,Pa=hs.eo,Ma=hs.af,Ta="js-contest-layer-hint",Ra=".contest-vote-btn",fc.prototype={performSimpleVote:{tap:function(t){vc(t,!1,function(){setTimeout(function(){var t=Ca.picture,e=Ca.next;e&&(t.fold(1),e.unfold().activate())},500)})}},performSuperVote:{tap:function(t){function e(){Ma.winphone||ka.launchAnimation(a)}var n,o,a=va.parentBySelector(t.target,Ra);!Aa.isSupported||Ma.winphone||localStorage.getItem("super-sympathy-warned")?vc(t,!0,e):(n=fs.createElement("DIV"),fa.addClass(n,Ta),o=a.getAttribute("data-warning-url"),Ia.show({url:o,target:n,dontPush:!0}))}},dialogCloseAndCancel:{tap:function(){fa.hasClass(fs.body,"__under-layer")?(logClientEvent("photowall.super-sympathy.warn",["continued"]),localStorage.setItem("super-sympathy-warned","1"),Ia.hide()):Pa.back()}},dialogCloseAndContinue:{tap:function(){logClientEvent("photowall.super-sympathy.warn",["cancelled"]),localStorage.setItem("super-sympathy-warned","1"),Ia.hide(),setTimeout(function(){fs.querySelector(Ra+".__super").click()},125)}},donateViewsExecute:{tap:function(t){var e,n,o=this;fa.hasClass(fs.body,"__under-layer")?(e=va.parentBySelector(t.target,".dotate-views_item"),fa.addClass(e,"untouchable"),logClientEvent("photowall.view-donation.warn",["continued"]),n=ga.getPhotoWallContestId(Ca.photo).photoWallContestId,ya.executePhotowallViewDonation(Ea.id,n,Sa).then(function(t){if(t.success){if(t.payUrl)return void _a.change(t.payUrl);t.html&&(o.modalRoot.getElementsByClassName("block")[0].innerHTML=t.html,fs.querySelector(".donate-views_modal .base-button_content_text").textContent=t.closeBtnLabel)}})):Pa.back()}}},Na.attach(function(t){var e,n=t.target;n&&fa.hasClass(n,Ta)&&(e=t.dialog.getContentElement(),fa.addClass(e.parentNode,"__contest-hint"))}),xa.addFuncHandler("makePhotoWallPresent",{tap:function(){Sa&&_a.change("/topphoto/store/"+Sa)}}),xa.addFuncHandler("showCombinedPresentModal",{tap:function(){var t,e;Sa&&(t=fs.createElement("DIV"),fa.addClass(t,Ta),e="/topphoto/donate/"+Sa,Ia.show({url:e,target:t,dontPush:!0}))}}),xa.addFuncHandler("donateViewsExpand",{tap:function(){var t,e;Sa&&(t=fs.createElement("DIV"),fa.addClass(t,Ta),e="/topphoto/donate/"+Sa,Ia.show({url:e,target:t,dontPush:!0}))}}),wa.create("photowall",fc,function(t){},function(t){Ea=t;var e,n,o=ga.getPhotoWallContestId(Ea);o&&(e=o.photoWallContestId,n=ga.isPhotoWallParticipating(),ya.photoWallRegisterView(Ea.id,e,n).then(function(t){var e=fs.getElementsByClassName("photowall-progress_line")[0];e&&(e.style.width=t.viewProgress+"%")}),Sa=t.ownerId)}),ba.register("photoWallContest",fc),T)),hs.tr=ms.aUwEgHw||(ms.aUwEgHw=(Da=hs.sl,Ba=hs.n,za=hs.sf,qa=hs.rs,Oa=hs.jo,ja=hs.rr,Va=hs.sj,Wa=hs.rq,gc.prototype={acceptAllAutoPins:{tap:function(){Oa.acceptAllAutoPins(La.id),Va.refreshPins()}}},Da.create("autoPinsPanel",gc,function(t){Ha=t.pinsFooterPanel},bc),Wa.pinProcessed.attach(function(t){bc(t.photo)}),T)),hs.ts=ms.cCaS87A||(ms.cCaS87A=(Fa=hs.n,Ua=hs.ah,Qa=hs.rw,Xa=hs.rs,Za=hs.rr,Ya=hs.rq,Ka=hs.ru,Ga=hs.v,Ja=hs.eo,$a=hs.rv,tr=hs.sp,er=hs.st,nr=hs.su,or=hs.sv,ar=hs.sw,rr=hs.sx,ir=hs.sy,sr=hs.sz,cr=hs.ta,lr=hs.tb,dr=hs.tc,ur=hs.td,pr=hs.te,hr=hs.tf,mr=hs.tg,fr=hs.th,vr=hs.e,hs.rx,gr=hs.af,br=hs.ee,Cr=hs.r,yr=hs.ti,wr=hs.jo,hs.tj,hs.tn,hs.to,hs.tq,hs.tr,hs.sa,hs.sm,xr=gr.androidVersion,_r=xr&&xr.number<4,kr=new Date,Cc.prototype={setVisible:function(t){Fa.switchClass(this.domBox,!t,"__hidden")},setBusy:function(t){this.domBox.setAttribute("aria-busy",t)},init:function(t){$a.init(t),ar.listen(),this.dom=t}},Ya.pictureSelected.attach(function(t){var e=t.photo;Ka.context(e);var n=Ka.getViewMode();Za.modPin="PIN"==n||"PIN_MARK"==n;var o=Ka.photo(e.id);o.photo=e,Za.layer&&Za.layer.progress(o),o.then(yc,function(){}),wr.logPhotoView(T.pageCtx.stateId,Za.logCmd,e.id,!0)}),wc.prototype={setVisible:function(t){this.view.setVisible(t)},menuStateReset:function(){this.menuState={}},menu:{tap:function(t){var e,n=Za.photo;n&&((e=this.menuState).hide?e.hide():this.menuState=tr.show(t.target.parentNode,n),e.photo=n)}},close:Ua.handle("tap",function(){Za.modPin=!1;var t=$a.getState();t&&t.photo&&(_r?Ja.go({url:Ya.urlAtLaunch},"replaceState"):Ya.options&&Ya.options.returnUrl||Ja.back()),kr=new Date,setTimeout(function(){_c()},400)}),viewPins:{tap:function(t){Za.modPin=!Za.modPin,Fa.switchClass(t.target,Za.modPin,"__mod");var e=Za.controls&&Za.controls.view;e&&(Fa.switchClass(e.dom.footer,Za.modPin,"hidden"),Fa.switchClass(e.dom.pinsFooter,!Za.modPin,"hidden")),Za.picture&&Fa.switchClass(Za.picture.pinsBox,!Za.modPin,"hidden")}},descr:xc(er),attachSequence:xc(nr),photowallViewProgress:xc(or),setCover:xc(lr),setMain:xc(cr),del:xc(rr),spam:xc(dr),info:xc(ur),blockUser:xc(pr),addBookmark:xc(hr),exitContest:xc(mr),removeCover:xc(ir),adjustCover:xc(sr),inviteToDuel:xc(fr)},Ua.register("controls",wc),Cr.rendering.attach(function(){var t=Ya.options;t&&(t.returnUrl=null)}),$a.deactivated.attach(function(){var t,e=Ya.options;e&&e.returnUrl&&(t=T.location.href)!==e.landedUrl&&(e.returnUrl=t),_c()}),yr.fetch(Xa.createControls().domRoot),{create:function(t){var e=Xa.createControls(),n=e.domRoot;t.appendChild(n);var o=Ua.getOrMakeBehavior(n);return o.view.init(e),Za.controls=o}})),hs.tt=ms.amFLnlQ||(ms.amFLnlQ=(Ar=hs.ru,Ir=hs.i,{start:function(t){var n=Ir.start(),o=n.reject.bind(n),e=Ar.nextPhotoId(t),a=Ar.previousPhotoId(t);return e.then(function(e){a.then(function(t){n.resolveIfNotDone({next:e,previous:t})},o)},o),n}})),hs.tu=ms.abG795g||(ms.abG795g=(Nr=hs.rr,Pr=hs.tt,Mr=hs.ru,Er=hs.so,(Sr=hs.rq).pictureSelected.attach(function(l){kc(Nr.layer,null,!0),Pr.start(l.photo.id).then(function(e){function t(t,r,i){var s,c=Nr.layer;t?kc(c,r,!1):((s=e[r])&&Mr.photo(s).then(function(t){var e,n,o,a;l==Nr.picture&&(n=t,o=i,(a=Er.create(n)).load(n.url,!0),a.fold(o),e=a,Nr[r]=e,c&&(kc(c,r,!1),function(t,n,e){{var o;1<Nr.activatedPicturesCount&&((o=t.loadTask)&&o.then(function(){Pr.start(e).then(function(t){var e;(e=t[n])&&Mr.photo(e).then(function(t){(new Image).src=t.url})})}))}}(e,r,s)))}),Sr.adjacentPhotoRequested.trigger({direction:r,currentPhotoId:l.photo.id}))}t(Nr.next,"next",-1),t(Nr.previous,"previous",1)})}),T)),hs.tv=ms.nTQI2w||(ms.nTQI2w=(Tr=hs.rr,Rr=hs.rs,Dr=hs.rq,Br=hs.sf,hs.fa,zr=hs.n,qr=hs.ah,Or=hs.af,jr=hs.tk,Vr=hs.ss,Wr=hs.j,Hr=Ac("next",1),Lr=Ac("previous",-1),Ic.prototype={next:Hr,previous:Lr},qr.register("navigationButtons",Ic),{create:function(t){var r,e=Rr.createNavigationButtons();function n(t){var e,n,o,a;r>new Date-200||(r=new Date,e=32==t.keyCode||13==t.keyCode||39==t.keyCode||40==t.keyCode,n=37==t.keyCode||38==t.keyCode,((o=27==t.keyCode)||n||e)&&!/input|textarea/i.test(t.target.tagName)&&(t.repeat||(o&&Tr.controls?(a=Vr.topmost)?Vr.close(a):Tr.controls.close():(e?Hr:Lr).tap()),zr.preventDefault(t)))}t.appendChild(e.domRoot),Or.desktop&&(r=new Date,fs.addEventListener("keydown",n,!1),Dr.close.attachOnce(function(){fs.removeEventListener("keydown",n,!1)})),Br.get().then(function(t){jr.label(e.toNext,t.nav.next),jr.label(e.toPrevious,t.nav.previous)})}})),hs.tw=ms.lnMFhQ||(ms.lnMFhQ=(Fr=hs.ru,Ur=hs.g,{parse:function(t){return t.okPhoto||(t.okPhoto=Pc(t))}})),hs.tx=ms.vNN6u9w||(ms.vNN6u9w=(Qr=hs.bd,Xr=hs.bf,Zr={top:0,left:0,bottom:0,right:0},{inViewport:Ec,isInElement:function(t,e,n,o){var a=t&&t.getBoundingClientRect()||Zr,r=e&&e.getBoundingClientRect()||Zr,i=n&&o||!0,s=n&&!o,c=!n&&o;if(i||s){var l=a.top<=r.top&&r.bottom<=a.bottom;if(s)return l}if(i||c){var d=a.left<=r.left&&r.right<=a.right;if(c)return d}return d&&l},firstInViewport:function(t){return Xr.first(t,Ec)}})),hs.ty=ms.lmGvtlQ||(ms.lmGvtlQ=(Yr=hs.cf,Kr=hs.bd,Gr=hs.n,Jr=hs.rr,$r=hs.rq,ti=hs.sb,ei=hs.ru,ni=hs.sc,oi=hs.sd,ai=hs.so,ri=hs.ts,hs.tu,ii=hs.tv,si=hs.tw,hs.i,hs.bb,ci=hs.tl,li=hs.sf,di=hs.af,ui=hs.as,pi=hs.r,hi=hs.tx,mi=hs.rw,fi=hs.al,vi=hs.ea,gi=hs.aj,bi=hs.j,qi=di.androidVersion&&di.androidVersion.number,Oi=di.ie||qi&&qi<4,ji=.005,Vi=.001,Wi={close:Qc},{launch:Bc})),hs.tz=ms.pK8QbA||(ms.pK8QbA={sumUp:function(t,e,n){var o=t.x+n.x-e.cx,a=t.y+n.y-e.cy,r=e.zoom-1,i=e.zoom*n.zoom;return{x:e.x+n.x+o*r,y:e.y+n.y+a*r,cx:0,cy:0,zoom:i}}}),hs.ua=ms.skEphuA||(ms.skEphuA={createSize:function(t,e){var n=t.naturalHeight,o=t.naturalWidth,a=e.width,r=e.height,i=Math.min(a,o),s=i*n/o;return r<s&&(i=(s=r)*o/n),{width:i,height:s,naturalWidth:o,naturalHeight:n,x:a/2-i/2,y:r/2-s/2,zoom:1}},ajustOffsetsByCover:function(t,e,n,o){var a=n.right-n.left,r=n.bottom-n.top,i=t.width,s=t.height,c=Math.max(a/i,0);c=Math.max(r/s,c);var l=Math.max(e.zoom,c);o&&(l=Math.min(l,o));var d,u=e.translateX-(l-1)*t.width/2;u>n.left?e.translateX=e.translateX-u+n.left:(d=u+l*t.width)<n.right&&(e.translateX=e.translateX-d+n.right);var p,h=e.translateY-(l-1)*t.height/2;h>n.top?e.translateY=e.translateY-h+n.top:(p=h+e.zoom*t.height)<n.bottom&&(e.translateY=e.translateY-p+n.bottom),e.zoom=l}}),hs.ub=ms.fAdMUdA||(ms.fAdMUdA=(Hi=hs.ar,Li=hs.cf,Fi=hs.ry,Ui=hs.tz,Qi=hs.ua,Xi=hs.sn.create(),{createFoldAnimation:function(c,l,d,u,t,e){var p,h,m,f=0,v=0,g=Fi.none,b="",C=e||2,y=!1,w=t||{};function o(){h=!1;var t,e,n,o,a,r,i=l,s=f%1==0&&v%1==0;d&&i&&(t=i.zoom,b!==(e=y||s&&!p?"":"none")&&(Li.setStyle(c,b=e),w.onTransitioStyleChage&&w.onTransitioStyleChage(e)),n=function(t){return(t=t||p).sum&&t.sumBase==g?t.sum:Ui.sumUp(l,t,g)}(),i.zoom*n.zoom<C&&(o=i.x+n.x,a=i.y+n.y,r=t*n.zoom,m={translateX:o,translateY:a,zoom:r},Qi.ajustOffsetsByCover(l,m,u,C),Hi.moveAndScale(c,m.translateX,m.translateY,m.zoom),w.onMoveAndScale&&w.onMoveAndScale(m)),y=!1)}return{to:function(t,e,n){t==f&&e==v&&!n||(p=n,f=t,v=e,l&&(h||Xi.schedule(o),h=!0))},currentOffsets:function(){return m}}}})),hs.uc=ms.ajXmvFA||(ms.ajXmvFA=(Zi=hs.ah,Yi=hs.n,Ki=hs.jv,Gi=hs.ae,Ji=hs.ry,$i=hs.ub,ts=hs.ua,es=hs.ar,ns=hs.cf,os=hs.al,Zc.prototype={adjust:{touchStart:function(t,e){var n=Gi.touches(t);this.panAndZoom.reset(n[0],1<n.length?n[1]:null);var o=this.foldAnimation.currentOffsets();this.size.zoom=o.zoom,this.size.x=o.translateX,this.size.y=o.translateY},touchMove:function(t,e){this.move(t)},touchEnd:function(t,e){this.updateInputs()}},move:function(t){var e,n,o,a=Gi.touches(t);a&&(this.panAndZoom.note(a[0],1<a.length?a[1]:null),n=(e=this.panAndZoom.peek()).x/this.viewport.width,o=e.y/this.viewport.height,this.foldAnimation.to(-n,o,e))},updateInputs:function(){var t=Xc(this.dom.image,this.root),e=this.size.naturalWidth/(t.right-t.left),n=this.cropRect;this.input1X.value=Math.round((n.left-t.left)*e),this.input1Y.value=Math.round((n.top-t.top)*e),this.input2X.value=Math.round((n.right-t.left)*e),this.input2Y.value=Math.round((n.bottom-t.top)*e)}},Zc.isInstant=!0,Zi.register("adjustCoverCrop",Zc),T)),ms.pZH3Yg||(ms.pZH3Yg=(hs.rp,as=hs.rq,rs=hs.ty,is=hs.at,ss=hs.rv,cs=hs.dh,ls=hs.n,ds=hs.d,us=hs.g,hs.uc,ps={},cs.register(function(t){return Gc(t.uri)}),ss.activated.attach(function(){ds.photoLayerIsOpen||Jc()}),as.launch=Kc,as.findLinksToPhoto=function(t){return fs.querySelectorAll(['a.js-click[href*="st.phoId=',t.id,'"]'].join(""))},as.log=function(){is.log("photo",arguments)},ds.photoLayer={launch:Kc,launchShortlink:Jc},T))}(this);